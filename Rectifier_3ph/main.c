/*
 * main.c
 *
 *  Created on: 06-07-2020
 *      Author: Matias_L
 */
//
// Included Files
//
#include "task_file.h"
#include "F28x_Project.h"
#include "F2837xD_Cla_defines.h"
#include <CLAmath.h>
//
// Defines
//
#define soc0 0
#define soc1 1
#define soc2 2
#define soc3 3
#define soc4 4
#define soc5 5
#define soc6 6
#define soc7 7
#define soc8 8

extern uint16_t Cla1ProgRunStart, Cla1ProgLoadStart, Cla1ProgLoadSize;
extern uint16_t CLA1mathTablesRunStart, CLA1mathTablesLoadStart;
extern uint16_t CLA1mathTablesLoadSize;
//
// Globals
//------------maquina-de-estados-------------//
uint16_t sw1, sw2;
uint16_t estado   = 1;
uint16_t vdc_2    = 530;
uint16_t boton_1  = 0;
uint16_t boton_2  = 0;
uint16_t fault    = 0;
//-------------------------------------------//
//-------------Variables-fallas--------------//

// estado sincronizacion del pll
float vg_d, vg_q, i_out;
int cont_sinc; // agregar al inicio del código
// estado precarga
float va, vb, vc;
int cont_precarg;
// estado normal mode
int cont_normal, cont_norm_fase;
float vdc;
//-------------------------------------------//
//Task Variables
//
//------------Variables-de-prueba------------//
#pragma DATA_SECTION(Num,"CpuToCla1MsgRAM");
float Num;
#pragma DATA_SECTION(Den,"CpuToCla1MsgRAM");
float Den;
#pragma DATA_SECTION(Res,"Cla1ToCpuMsgRAM");
float Res;
#pragma DATA_SECTION(salida_prueba,"Cla1ToCpuMsgRAM");
float salida_prueba;
#pragma DATA_SECTION(voltFilt,"Cla1ToCpuMsgRAM")
float voltFilt;
#pragma DATA_SECTION(a1,"Cla1ToCpuMsgRAM");
float a1;
#pragma DATA_SECTION(a2,"Cla1ToCpuMsgRAM");
float a2;
#pragma DATA_SECTION(a3,"Cla1ToCpuMsgRAM");
float a3;
#pragma DATA_SECTION(a4,"Cla1ToCpuMsgRAM");
float a4;
#pragma DATA_SECTION(a5,"Cla1ToCpuMsgRAM");
float a5;
#pragma DATA_SECTION(a6,"Cla1ToCpuMsgRAM");
float a6;
#pragma DATA_SECTION(a7,"Cla1ToCpuMsgRAM");
float a7;
#pragma DATA_SECTION(a8,"Cla1ToCpuMsgRAM");
float a8;
#pragma DATA_SECTION(a9,"Cla1ToCpuMsgRAM");
float a9;
#pragma DATA_SECTION(a10,"Cla1ToCpuMsgRAM");
float a10;
#define BLINKY_LED_GPIO    31
uint16_t aaa = 0;
int bbb = 0;
int ccc = 0;
int vg_q1 = 10;
//int k = 1;
//    int va[5] = {1.95, -295.9, -184.4, 182.8, 296.5};
//    int vb[5] = {268.4, 231.2, -124.7, 309.4, -66.6};
//    int vc[5] = {-270.4, 64.7, 309.2, 126.5, -229.9};
//    int ia[5] = {0.06, -10.2, -6.3, 6.3, 10.25};
//    int ib[5] = {9.15, 7.9, -4.3, -10.7, -2.3};
//    int ic[5] = {-9.22, 2.2, 10.6, 4.36, -8};

//float valores[84] = {0,0,-269.44387170614959,269.44387170614959,0.001,96.143525378740634,-304.32811265129925,208.1845872725587,0.002,182.87585262207952,-309.4225975514978,126.5467449294184,0.0030000000000000001,251.70701723978109,-284.22864272935044,32.521625489569438,0.0040000000000000001,295.89934526414123,-231.21240801945387,-64.686937244687243,0.0050000000000000001,311.12698372208092,-155.5634918610404,-155.56349186104038,0.0060000000000000001,295.89934526414123,-64.686937244687215,-231.21240801945393,0.0070000000000000001,251.70701723978109,32.521625489569395,-284.22864272935033,0.0080000000000000002,182.87585262207955,126.54674492941837,-309.4225975514978,0.0090000000000000011,96.143525378740549,208.18458727255876,-304.32811265129925,0.01,3.8102066474361705e-14,269.44387170614959,-269.44387170614971,0.010999999999999999,-96.143525378740591,304.32811265129925,-208.18458727255879,0.012,-182.87585262207958,309.4225975514978,-126.54674492941831,0.013000000000000001,-251.70701723978124,284.22864272935033,-32.521625489569061,0.014,-295.89934526414123,231.2124080194539,64.686937244687073,0.014999999999999999,-311.12698372208092,155.56349186104043,155.56349186104021,0.016,-295.89934526414123,64.686937244687329,231.21240801945373,0.017000000000000001,-251.70701723978098,-32.521625489569637,284.22864272935055,0.018000000000000002,-182.87585262207935,-126.54674492941859,309.42259755149786,0.019,-96.143525378740719,-208.18458727255862,304.32811265129931,0.02,-7.620413294872341e-14,-269.44387170614965,269.44387170614976};
//float valores_2[404] = {0,0,-269.44387170614959,269.44387170614959,0.00020000000000000001,19.535824947497687,-278.68009824768433,259.14427330018657,0.00040000000000000002,38.994550918997056,-286.81650175826167,247.82195083926459,0.00060000000000000006,58.29938321293487,-293.82097157039465,235.52158835745982,0.00080000000000000004,77.374134475785922,-299.66586424177268,222.29172976598682,0.001,96.143525378740634,-304.32811265129925,208.1845872725587,0.0012000000000000001,114.53348171082412,-307.78931703448069,193.25583532365661,0.0014,132.47142671596552,-310.03581759889045,177.56439088292493,0.0016000000000000001,149.88656752029706,-311.05874843312921,161.17218091283215,0.0018000000000000002,166.71017451928509,-310.85407249652695,144.14389797724195,0.002,182.87585262207952,-309.4225975514978,126.5467449294184,0.0022000000000000001,198.31980328260448,-306.76997297567129,108.45016969306687,0.0024000000000000002,212.98107628327276,-302.90666746637913,89.925591183106434,0.0026000000000000003,226.80181027764922,-297.84792772549014,71.046117447840999,0.0028,239.72746114275077,-291.61371828764334,51.886257144892696,0.0030000000000000001,251.70701723978109,-284.22864272935044,32.521625489569438,0.0032000000000000002,262.69320073376377,-275.72184656991999,13.028645836156247,0.0034000000000000002,272.64265417755797,-266.12690224740771,-6.5157519301501559,0.0036000000000000003,281.51611162389372,-255.48167662354149,-26.034435000352158,0.0038,289.27855359012761,-243.82818154051782,-45.450372049609612,0.0040000000000000001,295.89934526414123,-231.21240801945387,-64.686937244687243,0.0042000000000000006,301.35235740594931,-217.68414475483846,-83.668212651110636,0.0044000000000000003,305.61606946787236,-203.29678162130173,-102.31928784657049,0.0045999999999999999,308.67365452630673,-188.10709896817059,-120.56655555813607,0.0048000000000000004,310.51304568990452,-172.17504353337097,-138.33800215653335,0.0050000000000000001,311.12698372208092,-155.5634918610404,-155.56349186104038,0.0052000000000000006,310.51304568990452,-138.33800215653335,-172.175043533371,0.0054000000000000003,308.67365452630668,-120.56655555813599,-188.10709896817059,0.0055999999999999999,305.61606946787236,-102.31928784657048,-203.29678162130179,0.0058000000000000005,301.35235740594931,-83.668212651110608,-217.68414475483851,0.0060000000000000001,295.89934526414123,-64.686937244687215,-231.21240801945393,0.0062000000000000006,289.27855359012756,-45.450372049609577,-243.82818154051782,0.0064000000000000003,281.51611162389372,-26.034435000352058,-255.48167662354163,0.0066,272.64265417755786,-6.5157519301500555,-266.12690224740771,0.0068000000000000005,262.69320073376377,13.028645836156347,-275.72184656991993,0.0070000000000000001,251.70701723978109,32.521625489569395,-284.22864272935033,0.0072000000000000007,239.72746114275066,51.886257144892788,-291.61371828764345,0.0074000000000000003,226.80181027764914,71.046117447841098,-297.84792772549019,0.0076,212.98107628327267,89.925591183106519,-302.90666746637913,0.0078000000000000005,198.3198032826044,108.45016969306697,-306.76997297567129,0.0080000000000000002,182.87585262207955,126.54674492941837,-309.4225975514978,0.0082000000000000007,166.71017451928495,144.14389797724203,-310.85407249652695,0.0084000000000000012,149.88656752029689,161.17218091283235,-311.05874843312921,0.0086,132.47142671596546,177.56439088292501,-310.03581759889045,0.0088000000000000005,114.53348171082406,193.2558353236567,-307.78931703448069,0.0090000000000000011,96.143525378740549,208.18458727255876,-304.32811265129925,0.0091999999999999998,77.374134475785922,222.29172976598679,-299.66586424177268,0.0094000000000000004,58.299383212934856,235.52158835745982,-293.82097157039459,0.0096000000000000009,38.994550918997007,247.82195083926462,-286.81650175826161,0.0097999999999999997,19.535824947497751,259.14427330018657,-278.68009824768433,0.01,0,269.44387170614959,-269.44387170614971,0.010200000000000001,-19.535824947497812,278.68009824768433,-259.14427330018646,0.010400000000000001,-38.994550918997206,286.81650175826172,-247.82195083926453,0.0106,-58.299383212934913,293.8209715703947,-235.52158835745979,0.010800000000000001,-77.374134475785993,299.66586424177274,-222.29172976598684,0.011000000000000001,-96.143525378740733,304.32811265129931,-208.18458727255859,0.0112,-114.53348171082411,307.78931703448069,-193.25583532365661,0.0114,-132.47142671596552,310.03581759889045,-177.56439088292484,0.011600000000000001,-149.88656752029709,311.05874843312921,-161.17218091283218,0.0118,-166.710174519285,310.85407249652695,-144.14389797724198,0.012,-182.87585262207958,309.4225975514978,-126.54674492941831,0.012200000000000001,-198.31980328260454,306.76997297567129,-108.45016969306666,0.012400000000000001,-212.98107628327281,302.90666746637908,-89.925591183106334,0.0126,-226.8018102776492,297.84792772549014,-71.046117447841041,0.012800000000000001,-239.7274611427508,291.61371828764328,-51.886257144892731,0.013000000000000001,-251.70701723978124,284.22864272935033,-32.521625489569061,0.0132,-262.69320073376389,275.72184656991988,-13.028645836156009,0.0134,-272.64265417755792,266.12690224740771,6.5157519301502553,0.013600000000000001,-281.51611162389378,255.48167662354143,26.034435000352119,0.013800000000000002,-289.27855359012761,243.82818154051779,45.45037204960957,0.014,-295.89934526414123,231.2124080194539,64.686937244687073,0.014200000000000001,-301.35235740594931,217.68414475483846,83.668212651110863,0.014400000000000001,-305.61606946787236,203.29678162130156,102.31928784657059,0.0146,-308.67365452630668,188.10709896817067,120.56655555813603,0.014800000000000001,-310.51304568990452,172.17504353337097,138.33800215653332,0.015000000000000001,-311.12698372208092,155.56349186104021,155.56349186104072,0.0152,-310.51304568990452,138.33800215653329,172.17504353337119,0.0154,-308.67365452630673,120.56655555813602,188.1070989681707,0.015600000000000001,-305.61606946787231,102.3192878465703,203.29678162130179,0.015800000000000002,-301.35235740594931,83.668212651110579,217.68414475483846,0.016,-295.89934526414123,64.686937244687329,231.21240801945373,0.016199999999999999,-289.27855359012767,45.450372049609818,243.82818154051765,0.016400000000000001,-281.51611162389361,26.03443500035182,255.4816766235416,0.0166,-272.64265417755786,6.5157519301499551,266.12690224740771,0.016800000000000002,-262.6932007337636,-13.028645836156583,275.72184656992016,0.017000000000000001,-251.70701723978098,-32.521625489569637,284.22864272935055,0.0172,-239.72746114275071,-51.886257144892753,291.61371828764339,0.017400000000000002,-226.80181027764897,-71.04611744784134,297.84792772549019,0.017600000000000001,-212.98107628327261,-89.925591183106633,302.90666746637913,0.0178,-198.31980328260443,-108.45016969306694,306.76997297567129,0.018000000000000002,-182.87585262207935,-126.54674492941859,309.42259755149786,0.018200000000000001,-166.71017451928498,-144.14389797724201,310.85407249652695,0.0184,-149.88656752029706,-161.1721809128322,311.05874843312921,0.018600000000000002,-132.47142671596538,-177.5643908829251,310.03581759889045,0.018800000000000001,-114.53348171082409,-193.25583532365664,307.78931703448075,0.019,-96.143525378740719,-208.18458727255862,304.32811265129931,0.019200000000000002,-77.374134475785823,-222.29172976598684,299.66586424177262,0.019400000000000001,-58.299383212934892,-235.52158835745968,293.82097157039459,0.019599999999999999,-38.994550918997177,-247.82195083926445,286.81650175826167,0.019800000000000002,-19.535824947497652,-259.14427330018668,278.68009824768433,0.02,0,-269.44387170614965,269.44387170614976};
//float valores_3[1604] = {0,0,-269.44387170614959,269.44387170614959,0,4.8869702575923908,-271.85411621316166,266.96714595556932,0.0001,9.7727347283990262,-274.19728478483859,264.42455005643956,0.00015000000000000001,14.656087923144002,-276.4727992793969,261.81671135625288,0.00020000000000000001,19.535824947497687,-278.68009824768433,259.14427330018657,0.00025000000000000001,24.410741799366402,-280.81863707170891,256.4078952723425,0.00030000000000000003,29.279635665961898,-282.88788809901553,253.60825243305365,0.00035,34.141305220577408,-284.88734077287603,250.74603555229868,0.00040000000000000002,38.994550918997056,-286.81650175826167,247.82195083926459,0.00045000000000000004,43.83817529546544,-288.67489506356588,244.83671976810041,0.00050000000000000001,48.670983258144346,-290.4620621580483,241.79107889990394,0.00055000000000000003,53.491782383983875,-292.17756208497036,238.6857797009865,0.00060000000000000006,58.29938321293487,-293.82097157039465,235.52158835745982,0.00065000000000000008,63.092599541430488,-295.39188512762155,232.29928558619105,0.00069999999999999999,67.870248715064065,-296.88991515723683,229.01966644217279,0.00075000000000000002,72.631151920391545,-298.31469204274629,225.68354012235474,0.00080000000000000004,77.374134475785922,-299.66586424177268,222.29172976598682,0.00085000000000000006,82.098026121272426,-300.94309837279405,218.84507225152169,0.00090000000000000008,86.801661307272653,-302.14607929740015,215.34441799012748,0.00095,91.483879482186424,-303.27451019804846,211.79063071586205,0.001,96.143525378740634,-304.32811265129925,208.1845872725587,0.0010500000000000002,100.77944929903413,-305.30662669651269,204.52717739747865,0.0011000000000000001,105.39050739820833,-306.20981089998992,200.81930350178155,0.00115,109.97556196667404,-307.03744241454325,197.06188044786924,0.0012000000000000001,114.53348171082412,-307.78931703448069,193.25583532365661,0.00125,119.06314203216334,-308.46524924599032,189.40210721382701,0.0013000000000000002,123.56342530478618,-309.06507227291303,185.50164696812695,0.0013500000000000001,128.03322115113426,-309.5886381178924,181.55541696675829,0.0014,132.47142671596552,-310.03581759889045,177.56439088292493,0.0014500000000000001,136.87694693846711,-310.40650038106139,173.52955344259436,0.0015,141.24869482244537,-310.70059500397554,169.45190018153025,0.0015500000000000002,145.5855917045258,-310.91802890418523,165.33243719965958,0.0016000000000000001,149.88656752029706,-311.05874843312921,161.17218091283215,0.00165,154.15056106833356,-311.12271887036917,156.9721578020357,0.0017000000000000001,158.3765202720308,-311.10992443215713,152.73340416012638,0.00175,162.56340243918964,-311.02036827532919,148.45696583613957,0.0018000000000000002,166.71017451928509,-310.85407249652695,144.14389797724195,0.0018500000000000001,170.81581335835574,-310.6110781267455,139.79526476838987,0.0019,174.8793059514521,-310.29144512120962,135.41213916975755,0.0019500000000000001,178.89964969258017,-309.89525234458063,130.99560265200054,0.002,182.87585262207952,-309.4225975514978,126.5467449294184,0.0020500000000000002,186.80693367137451,-308.87359736245895,122.06666369108441,0.0021000000000000003,190.69192290503824,-308.24838723504564,117.55646433000746,0.00215,194.52986176010958,-307.54712143050176,113.01725967039222,0.0022000000000000001,198.31980328260448,-306.76997297567129,108.45016969306687,0.0022500000000000003,202.06081236116231,-305.91713362030663,103.85632125914448,0.0023,205.75196595777081,-304.98881378975761,99.236847831986879,0.0023500000000000001,209.39235333551201,-303.98524253305146,94.592889197539577,0.0024000000000000002,212.98107628327276,-302.90666746637913,89.925591183106434,0.0024499999999999999,216.51724933736477,-301.75335471199924,85.236105374634491,0.0025000000000000001,220.00000000000003,-300.52558883257649,80.525588832576588,0.0025500000000000002,223.42846895456591,-299.2236727609702,75.795203806404359,0.0026000000000000003,226.80181027764922,-297.84792772549014,71.046117447840999,0.00265,230.11919164775477,-296.39869317063801,66.27950152288328,0.0027000000000000001,233.37979455066872,-294.87632667335487,61.496532122686247,0.0027500000000000003,236.58281448141409,-293.28120385479423,56.698389373380309,0.0028,239.72746114275077,-291.61371828764334,51.886257144892696,0.0028500000000000001,242.81295864016948,-289.87428139901465,47.061322758845314,0.0029000000000000002,245.83854567333208,-288.06332236893275,42.224776695600738,0.0029499999999999999,248.80347572391085,-286.18128802444033,37.377812300529563,0.0030000000000000001,251.70701723978109,-284.22864272935044,32.521625489569438,0.0030500000000000002,254.54845381552039,-282.2058682696715,27.657414454151152,0.0031000000000000003,257.32708436917096,-280.11346373473407,22.786379365563217,0.00315,260.04222331522124,-277.95194539404787,17.909722078826746,0.0032000000000000002,262.69320073376377,-275.72184656991999,13.028645836156247,0.0032500000000000003,265.2793625357881,-273.4237175058654,8.1443549700774884,0.0033,267.8000706245669,-271.05812523084319,3.2580546062764624,0.0033500000000000001,270.25470305309767,-268.6256534193501,-1.6290496337473448,0.0034000000000000002,272.64265417755797,-266.12690224740771,-6.5157519301501559,0.0034500000000000004,274.96333480673951,-263.56248824447806,-11.400846562261354,0.0035000000000000001,277.21617234742223,-260.93304414134428,-16.283128206077841,0.0035500000000000002,279.40061094565283,-258.23921871399352,-21.161392231659296,0.0036000000000000003,281.51611162389372,-255.48167662354149,-26.034435000352158,0.00365,283.56215241400736,-252.66109825223705,-30.901054161770293,0.0037000000000000002,285.53822848604449,-249.77817953558795,-35.760048950456422,0.0037500000000000003,287.44385227280287,-246.83363179064958,-40.61022048215311,0.0038,289.27855359012761,-243.82818154051782,-45.450372049609612,0.0038500000000000001,291.04187975292189,-240.76257033507034,-50.27930941785138,0.0039000000000000003,292.73339568684031,-237.6375545680003,-55.095841118839886,0.0039500000000000004,294.3526840356368,-234.45390529018772,-59.898778745448951,0.0040000000000000001,295.89934526414123,-231.21240801945387,-64.686937244687243,0.0040499999999999998,297.37299775683869,-227.91386254674674,-69.45913521009183,0.0041000000000000003,298.77327791202737,-224.55908273880442,-74.214195173222819,0.00415,300.09984023153174,-221.14889633734612,-78.950943894185514,0.0042000000000000006,301.35235740594931,-217.68414475483846,-83.668212651110636,0.0042500000000000003,302.5305203954091,-214.16568286689042,-88.36483752851845,0.0043,303.63403850582262,-210.59437880132486,-93.039659704497552,0.0043500000000000006,304.66263946060849,-206.97111372398135,-97.691525736627,0.0044000000000000003,305.61606946787236,-203.29678162130173,-102.31928784657049,0.00445,306.49409328302647,-199.57228907975212,-106.92180420327422,0.0045000000000000005,307.29649426683255,-195.7985550621363,-111.49793920469621,0.0045500000000000002,308.02307443885439,-191.9765106808556,-116.04656375799878,0.0045999999999999999,308.67365452630673,-188.10709896817059,-120.56655555813607,0.0046500000000000005,309.24807400828769,-184.19127464352206,-125.0567993647655,0.0047000000000000002,309.74619115538536,-180.23000387796853,-129.51618727741672,0.0047499999999999999,310.16788306464724,-176.22426405579753,-133.94361900884957,0.0048000000000000004,310.51304568990452,-172.17504353337097,-138.33800215653335,0.0048500000000000001,310.78159386744431,-168.08334139526309,-142.698252472181,0.0048999999999999998,310.97346133702206,-163.95016720775098,-147.02329412927091,0.0049500000000000004,311.0886007582107,-159.77654076971928,-151.31205998849131,0.0050000000000000001,311.12698372208092,-155.5634918610404,-155.56349186104038,0.0050500000000000007,311.0886007582107,-151.31205998849123,-159.77654076971936,0.0051000000000000004,310.97346133702206,-147.02329412927094,-163.95016720775098,0.0051500000000000001,310.78159386744431,-142.69825247218103,-168.08334139526312,0.0052000000000000006,310.51304568990452,-138.33800215653335,-172.175043533371,0.0052500000000000003,310.16788306464724,-133.94361900884954,-176.22426405579751,0.0053,309.74619115538536,-129.51618727741672,-180.2300038779685,0.0053500000000000006,309.24807400828769,-125.05679936476541,-184.19127464352218,0.0054000000000000003,308.67365452630668,-120.56655555813599,-188.10709896817059,0.00545,308.02307443885439,-116.04656375799868,-191.97651068085563,0.0055000000000000005,307.2964942668325,-111.49793920469605,-195.79855506213642,0.0055500000000000002,306.49409328302642,-106.92180420327419,-199.57228907975221,0.0055999999999999999,305.61606946787236,-102.31928784657048,-203.29678162130179,0.0056500000000000005,304.66263946060843,-97.6915257366269,-206.9711137239814,0.0057000000000000002,303.63403850582262,-93.039659704497581,-210.59437880132486,0.0057499999999999999,302.5305203954091,-88.364837528518493,-214.16568286689045,0.0058000000000000005,301.35235740594931,-83.668212651110608,-217.68414475483851,0.0058500000000000002,300.09984023153174,-78.950943894185471,-221.14889633734612,0.0058999999999999999,298.77327791202737,-74.214195173222777,-224.55908273880442,0.0059500000000000004,297.37299775683869,-69.459135210091802,-227.9138625467468,0.0060000000000000001,295.89934526414123,-64.686937244687215,-231.21240801945393,0.0060500000000000007,294.35268403563674,-59.898778745448858,-234.45390529018778,0.0061000000000000004,292.73339568684031,-55.095841118839786,-237.63755456800035,0.0061500000000000001,291.04187975292189,-50.279309417851415,-240.76257033507036,0.0062000000000000006,289.27855359012756,-45.450372049609577,-243.82818154051782,0.0062500000000000003,287.44385227280281,-40.610220482153082,-246.83363179064958,0.0063,285.53822848604449,-35.760048950456387,-249.77817953558795,0.0063500000000000006,283.56215241400736,-30.901054161770194,-252.66109825223697,0.0064000000000000003,281.51611162389372,-26.034435000352058,-255.48167662354163,0.00645,279.40061094565283,-21.161392231659196,-258.23921871399347,0.0065000000000000006,277.21617234742217,-16.283128206077741,-260.93304414134428,0.0065500000000000003,274.96333480673945,-11.400846562261252,-263.56248824447812,0.0066,272.64265417755786,-6.5157519301500555,-266.12690224740771,0.0066500000000000005,270.25470305309761,-1.6290496337473828,-268.62565341935016,0.0067000000000000002,267.8000706245669,3.2580546062764242,-271.05812523084325,0.0067499999999999999,265.2793625357881,8.1443549700774494,-273.4237175058654,0.0068000000000000005,262.69320073376377,13.028645836156347,-275.72184656991993,0.0068500000000000002,260.04222331522118,17.909722078826846,-277.95194539404798,0.0069000000000000008,257.3270843691709,22.786379365563317,-280.11346373473407,0.0069500000000000004,254.54845381552036,27.657414454151251,-282.20586826967161,0.0070000000000000001,251.70701723978109,32.521625489569395,-284.22864272935033,0.0070500000000000007,248.80347572391079,37.377812300529662,-286.18128802444039,0.0071000000000000004,245.83854567333205,42.224776695600845,-288.0633223689328,0.0071500000000000001,242.81295864016948,47.061322758845286,-289.87428139901465,0.0072000000000000007,239.72746114275066,51.886257144892788,-291.61371828764345,0.0072500000000000004,236.58281448141406,56.698389373380266,-293.28120385479423,0.0073000000000000001,233.37979455066872,61.496532122686212,-294.87632667335487,0.0073500000000000006,230.11919164775475,66.279501522883379,-296.39869317063796,0.0074000000000000003,226.80181027764914,71.046117447841098,-297.84792772549019,0.00745,223.42846895456589,75.795203806404444,-299.2236727609702,0.0075000000000000006,219.99999999999991,80.525588832576688,-300.52558883257655,0.0075500000000000003,216.51724933736475,85.23610537463459,-301.75335471199924,0.0076,212.98107628327267,89.925591183106519,-302.90666746637913,0.0076500000000000005,209.39235333551201,94.592889197539549,-303.98524253305146,0.0077000000000000002,205.75196595777081,99.23684783198685,-304.98881378975756,0.0077499999999999999,202.06081236116231,103.85632125914445,-305.91713362030663,0.0078000000000000005,198.3198032826044,108.45016969306697,-306.76997297567129,0.0078500000000000011,194.52986176010955,113.01725967039232,-307.54712143050176,0.0079000000000000008,190.69192290503815,117.55646433000756,-308.24838723504564,0.0079500000000000005,186.80693367137448,122.0666636910845,-308.87359736245895,0.0080000000000000002,182.87585262207955,126.54674492941837,-309.4225975514978,0.0080499999999999999,178.8996496925802,130.99560265200049,-309.89525234458063,0.0080999999999999996,174.87930595145215,135.41213916975749,-310.29144512120956,0.008150000000000001,170.8158133583556,139.79526476838998,-310.6110781267455,0.0082000000000000007,166.71017451928495,144.14389797724203,-310.85407249652695,0.0082500000000000004,162.56340243918959,148.45696583613966,-311.02036827532919,0.0083000000000000001,158.37652027203075,152.73340416012647,-311.10992443215713,0.0083499999999999998,154.1505610683335,156.97215780203575,-311.12271887036917,0.0084000000000000012,149.88656752029689,161.17218091283235,-311.05874843312921,0.0084500000000000009,145.58559170452565,165.33243719965967,-310.91802890418523,0.0085000000000000006,141.24869482244526,169.45190018153033,-310.70059500397554,0.0085500000000000003,136.87694693846703,173.52955344259442,-310.40650038106139,0.0086,132.47142671596546,177.56439088292501,-310.03581759889045,0.0086499999999999997,128.03322115113423,181.55541696675826,-309.5886381178924,0.0087000000000000011,123.56342530478604,185.50164696812706,-309.06507227291303,0.0087500000000000008,119.06314203216324,189.40210721382709,-308.46524924599026,0.0088000000000000005,114.53348171082406,193.2558353236567,-307.78931703448069,0.0088500000000000002,109.97556196667398,197.0618804478693,-307.03744241454325,0.0088999999999999999,105.3905073982083,200.8193035017816,-306.20981089998992,0.0089499999999999996,100.77944929903413,204.52717739747862,-305.30662669651269,0.0090000000000000011,96.143525378740549,208.18458727255876,-304.32811265129925,0.0090500000000000008,91.483879482186339,211.79063071586211,-303.2745101980484,0.0091000000000000004,86.801661307272582,215.3444179901276,-302.14607929740015,0.0091500000000000001,82.098026121272397,218.84507225152166,-300.94309837279405,0.0091999999999999998,77.374134475785922,222.29172976598679,-299.66586424177268,0.0092500000000000013,72.631151920391446,225.68354012235483,-298.31469204274629,0.009300000000000001,67.870248715063994,229.01966644217288,-296.88991515723677,0.0093500000000000007,63.092599541430424,232.2992855861911,-295.39188512762155,0.0094000000000000004,58.299383212934856,235.52158835745982,-293.82097157039459,0.0094500000000000001,53.491782383983882,238.6857797009865,-292.17756208497036,0.0094999999999999998,48.670983258144382,241.79107889990391,-290.46206215804824,0.0095500000000000012,43.838175295465355,244.83671976810047,-288.67489506356583,0.0096000000000000009,38.994550918997007,247.82195083926462,-286.81650175826161,0.0096500000000000006,34.141305220577387,250.74603555229868,-284.88734077287603,0.0097000000000000003,29.279635665961905,253.60825243305362,-282.88788809901553,0.00975,24.410741799366441,256.40789527234244,-280.81863707170891,0.0097999999999999997,19.535824947497751,259.14427330018657,-278.68009824768433,0.0098500000000000011,14.656087923143815,261.81671135625299,-276.47279927939678,0.0099000000000000008,9.7727347283990103,264.42455005643956,-274.19728478483864,0.0099500000000000005,4.8869702575924023,266.96714595556932,-271.8541162131616,0.01,0,269.44387170614959,-269.44387170614971,0.01005,-4.8869702575923251,271.85411621316166,-266.96714595556926,0.010100000000000001,-9.772734728399211,274.1972847848387,-264.42455005643939,0.010150000000000001,-14.656087923144154,276.47279927939695,-261.81671135625288,0.010200000000000001,-19.535824947497812,278.68009824768433,-259.14427330018646,0.01025,-24.410741799366502,280.81863707170896,-256.4078952723425,0.0103,-29.279635665961965,282.88788809901553,-253.60825243305351,0.01035,-34.141305220577451,284.88734077287609,-250.74603555229871,0.010400000000000001,-38.994550918997206,286.81650175826172,-247.82195083926453,0.010450000000000001,-43.838175295465554,288.67489506356588,-244.83671976810035,0.010500000000000001,-48.670983258144439,290.4620621580483,-241.79107889990388,0.01055,-53.491782383983946,292.17756208497036,-238.68577970098644,0.0106,-58.299383212934913,293.8209715703947,-235.52158835745979,0.01065,-63.092599541430488,295.39188512762155,-232.29928558619108,0.010700000000000001,-67.870248715064193,296.88991515723689,-229.01966644217282,0.010750000000000001,-72.631151920391645,298.31469204274629,-225.6835401223546,0.010800000000000001,-77.374134475785993,299.66586424177274,-222.29172976598684,0.01085,-82.098026121272454,300.94309837279405,-218.84507225152151,0.0109,-86.801661307272639,302.14607929740015,-215.34441799012762,0.01095,-91.483879482186396,303.2745101980484,-211.79063071586197,0.011000000000000001,-96.143525378740733,304.32811265129931,-208.18458727255859,0.011050000000000001,-100.77944929903417,305.30662669651269,-204.5271773974786,0.0111,-105.39050739820834,306.20981089998992,-200.81930350178158,0.01115,-109.97556196667404,307.03744241454325,-197.06188044786924,0.0112,-114.53348171082411,307.78931703448069,-193.25583532365661,0.011250000000000001,-119.06314203216343,308.46524924599032,-189.40210721382701,0.011300000000000001,-123.56342530478622,309.06507227291303,-185.50164696812678,0.011350000000000001,-128.03322115113428,309.5886381178924,-181.55541696675829,0.0114,-132.47142671596552,310.03581759889045,-177.56439088292484,0.01145,-136.87694693846709,310.40650038106139,-173.5295534425945,0.0115,-141.24869482244532,310.70059500397554,-169.45190018153016,0.011550000000000001,-145.58559170452583,310.91802890418523,-165.33243719965949,0.011600000000000001,-149.88656752029709,311.05874843312921,-161.17218091283218,0.011650000000000001,-154.15056106833356,311.12271887036917,-156.9721578020357,0.0117,-158.37652027203077,311.10992443215713,-152.73340416012644,0.01175,-162.56340243918962,311.02036827532919,-148.4569658361396,0.0118,-166.710174519285,310.85407249652695,-144.14389797724198,0.011850000000000001,-170.81581335835588,310.6110781267455,-139.79526476838967,0.011900000000000001,-174.87930595145224,310.29144512120962,-135.41213916975747,0.011950000000000001,-178.89964969258028,309.89525234458063,-130.99560265200043,0.012,-182.87585262207958,309.4225975514978,-126.54674492941831,0.01205,-186.80693367137454,308.8735973624589,-122.06666369108444,0.012100000000000001,-190.69192290503833,308.24838723504564,-117.55646433000724,0.012150000000000001,-194.5298617601097,307.54712143050176,-113.01725967039225,0.012200000000000001,-198.31980328260454,306.76997297567129,-108.45016969306666,0.01225,-202.06081236116233,305.91713362030663,-103.85632125914452,0.0123,-205.75196595777086,304.98881378975756,-99.236847831986651,0.01235,-209.39235333551204,303.98524253305146,-94.59288919753962,0.012400000000000001,-212.98107628327281,302.90666746637908,-89.925591183106334,0.012450000000000001,-216.51724933736486,301.75335471199918,-85.236105374634406,0.012500000000000001,-220.00000000000006,300.52558883257649,-80.525588832576474,0.01255,-223.42846895456591,299.2236727609702,-75.795203806404388,0.0126,-226.8018102776492,297.84792772549014,-71.046117447841041,0.01265,-230.11919164775477,296.39869317063801,-66.279501522883308,0.012700000000000001,-233.37979455066878,294.87632667335481,-61.496532122686283,0.012750000000000001,-236.58281448141412,293.28120385479423,-56.698389373380074,0.012800000000000001,-239.7274611427508,291.61371828764328,-51.886257144892731,0.01285,-242.81295864016951,289.87428139901465,-47.061322758845087,0.0129,-245.83854567333208,288.06332236893275,-42.224776695600923,0.012950000000000001,-248.80347572391102,286.18128802444022,-37.377812300529463,0.013000000000000001,-251.70701723978124,284.22864272935033,-32.521625489569061,0.013050000000000001,-254.54845381552047,282.20586826967144,-27.657414454151191,0.013100000000000001,-257.32708436917102,280.11346373473407,-22.786379365562979,0.01315,-260.04222331522129,277.95194539404787,-17.909722078826785,0.0132,-262.69320073376389,275.72184656991988,-13.028645836156009,0.013250000000000001,-265.2793625357881,273.4237175058654,-8.1443549700775257,0.013300000000000001,-267.80007062456696,271.05812523084319,-3.2580546062762239,0.013350000000000001,-270.25470305309767,268.6256534193501,1.6290496337473064,0.0134,-272.64265417755792,266.12690224740771,6.5157519301502553,0.01345,-274.96333480673951,263.56248824447806,11.400846562261176,0.0135,-277.21617234742223,260.93304414134428,16.28312820607794,0.013550000000000001,-279.40061094565294,258.23921871399341,21.161392231659534,0.013600000000000001,-281.51611162389378,255.48167662354143,26.034435000352119,0.013650000000000001,-283.56215241400741,252.66109825223694,30.901054161770531,0.0137,-285.53822848604449,249.7781795355879,35.76004895045638,0.01375,-287.44385227280287,246.83363179064955,40.610220482153345,0.013800000000000002,-289.27855359012761,243.82818154051779,45.45037204960957,0.013850000000000001,-291.04187975292189,240.76257033507034,50.279309417851614,0.013900000000000001,-292.73339568684031,237.63755456800033,55.095841118839715,0.013950000000000001,-294.3526840356368,234.45390529018775,59.89877874544905,0.014,-295.89934526414123,231.2124080194539,64.686937244687073,0.01405,-297.37299775683869,227.91386254674677,69.459135210091929,0.014100000000000001,-298.77327791202737,224.55908273880436,74.214195173223032,0.014150000000000001,-300.0998402315318,221.14889633734603,78.950943894185457,0.014200000000000001,-301.35235740594931,217.68414475483846,83.668212651110863,0.014250000000000001,-302.5305203954091,214.16568286689039,88.364837528518422,0.0143,-303.63403850582262,210.59437880132481,93.03965970449778,0.01435,-304.66263946060843,206.97111372398135,97.691525736626829,0.014400000000000001,-305.61606946787236,203.29678162130156,102.31928784657059,0.014450000000000001,-306.49409328302642,199.57228907975215,106.92180420327405,0.014500000000000001,-307.2964942668325,195.79855506213636,111.49793920469617,0.01455,-308.02307443885439,191.97651068085565,116.0465637579985,0.0146,-308.67365452630668,188.10709896817067,120.56655555813603,0.014650000000000002,-309.24807400828769,184.19127464352198,125.05679936476572,0.014700000000000001,-309.74619115538536,180.23000387796844,129.51618727741669,0.014750000000000001,-310.16788306464724,176.22426405579745,133.94361900884979,0.014800000000000001,-310.51304568990452,172.17504353337097,138.33800215653332,0.01485,-310.78159386744431,168.08334139526309,142.6982524721812,0.0149,-310.97346133702206,163.95016720775095,147.02329412927085,0.014950000000000001,-311.0886007582107,159.77654076971908,151.3120599884914,0.015000000000000001,-311.12698372208092,155.56349186104021,155.56349186104072,0.015050000000000001,-311.0886007582107,151.31205998849114,159.77654076971933,0.015100000000000001,-310.97346133702206,147.02329412927085,163.95016720775118,0.01515,-310.78159386744426,142.69825247218094,168.08334139526309,0.0152,-310.51304568990452,138.33800215653329,172.17504353337119,0.015250000000000001,-310.16788306464724,133.94361900884951,176.22426405579748,0.015300000000000001,-309.74619115538536,129.51618727741669,180.2300038779687,0.015350000000000001,-309.24807400828769,125.05679936476545,184.19127464352204,0.0154,-308.67365452630673,120.56655555813602,188.1070989681707,0.01545,-308.02307443885439,116.04656375799871,191.97651068085548,0.0155,-307.29649426683255,111.49793920469614,195.79855506213639,0.015550000000000001,-306.49409328302642,106.92180420327404,199.57228907975238,0.015600000000000001,-305.61606946787231,102.3192878465703,203.29678162130179,0.015650000000000001,-304.66263946060843,97.691525736626815,206.9711137239816,0.015700000000000002,-303.63403850582256,93.039659704497481,210.59437880132486,0.01575,-302.53052039540904,88.364837528518393,214.16568286689059,0.015800000000000002,-301.35235740594931,83.668212651110579,217.68414475483846,0.01585,-300.09984023153174,78.950943894185443,221.14889633734629,0.015900000000000001,-298.77327791202737,74.214195173222748,224.55908273880439,0.015950000000000002,-297.37299775683863,69.459135210091631,227.9138625467468,0.016,-295.89934526414123,64.686937244687329,231.21240801945373,0.016050000000000002,-294.35268403563668,59.898778745448752,234.45390529018775,0.0161,-292.73339568684031,55.095841118839964,237.63755456800016,0.016150000000000001,-291.04187975292183,50.279309417851316,240.76257033507034,0.016199999999999999,-289.27855359012767,45.450372049609818,243.82818154051765,0.016250000000000001,-287.44385227280281,40.610220482153053,246.83363179064958,0.016300000000000002,-285.53822848604432,35.760048950456081,249.77817953558807,0.01635,-283.56215241400736,30.901054161770233,252.66109825223694,0.016400000000000001,-281.51611162389361,26.03443500035182,255.4816766235416,0.016449999999999999,-279.40061094565283,21.161392231659232,258.23921871399347,0.016500000000000001,-277.21617234742212,16.283128206077642,260.93304414134428,0.016550000000000002,-274.9633348067394,11.400846562261153,263.56248824447823,0.0166,-272.64265417755786,6.5157519301499551,266.12690224740771,0.016650000000000002,-270.25470305309756,1.6290496337472826,268.62565341935021,0.0167,-267.80007062456684,-3.2580546062765241,271.05812523084319,0.016750000000000001,-265.27936253578798,-8.1443549700775506,273.42371750586551,0.016800000000000002,-262.6932007337636,-13.028645836156583,275.72184656992016,0.01685,-260.04222331522118,-17.909722078826807,277.95194539404798,0.016900000000000002,-257.32708436917079,-22.786379365563555,280.1134637347343,0.01695,-254.54845381552039,-27.657414454151212,282.20586826967156,0.017000000000000001,-251.70701723978098,-32.521625489569637,284.22864272935055,0.017049999999999999,-248.80347572391091,-37.377812300529484,286.18128802444033,0.017100000000000001,-245.83854567333196,-42.224776695600937,288.06332236893286,0.017150000000000002,-242.81295864016943,-47.061322758845378,289.87428139901465,0.0172,-239.72746114275071,-51.886257144892753,291.61371828764339,0.017250000000000001,-236.582814481414,-56.698389373380365,293.28120385479423,0.017299999999999999,-233.37979455066866,-61.496532122686304,294.87632667335492,0.017350000000000001,-230.11919164775477,-66.279501522883336,296.39869317063796,0.017400000000000002,-226.80181027764897,-71.04611744784134,297.84792772549019,0.01745,-223.42846895456591,-75.795203806404416,299.2236727609702,0.017500000000000002,-219.99999999999986,-80.525588832576773,300.52558883257655,0.01755,-216.51724933736486,-85.23610537463442,301.75335471199918,0.017600000000000001,-212.98107628327261,-89.925591183106633,302.90666746637913,0.017650000000000002,-209.39235333551193,-94.592889197539634,303.98524253305152,0.0177,-205.75196595777072,-99.23684783198695,304.98881378975756,0.017750000000000002,-202.06081236116219,-103.85632125914454,305.91713362030669,0.0178,-198.31980328260443,-108.45016969306694,306.76997297567129,0.017850000000000001,-194.52986176010955,-113.01725967039229,307.54712143050176,0.017899999999999999,-190.69192290503818,-117.55646433000751,308.24838723504564,0.017950000000000001,-186.80693367137451,-122.06666369108447,308.87359736245895,0.018000000000000002,-182.87585262207935,-126.54674492941859,309.42259755149786,0.01805,-178.89964969258023,-130.99560265200046,309.89525234458063,0.018100000000000002,-174.87930595145195,-135.41213916975772,310.29144512120968,0.018149999999999999,-170.81581335835585,-139.7952647683897,310.6110781267455,0.018200000000000001,-166.71017451928498,-144.14389797724201,310.85407249652695,0.018250000000000002,-162.56340243918936,-148.45696583613986,311.02036827532919,0.0183,-158.37652027203077,-152.73340416012644,311.10992443215713,0.018350000000000002,-154.1505610683333,-156.97215780203598,311.12271887036917,0.0184,-149.88656752029706,-161.1721809128322,311.05874843312921,0.018450000000000001,-145.58559170452557,-165.33243719965975,310.91802890418523,0.018500000000000003,-141.24869482244517,-169.45190018153045,310.70059500397554,0.018550000000000001,-136.87694693846694,-173.5295534425945,310.40650038106139,0.018600000000000002,-132.47142671596538,-177.5643908829251,310.03581759889045,0.01865,-128.03322115113414,-181.55541696675832,309.5886381178924,0.018700000000000001,-123.56342530478608,-185.50164696812703,309.06507227291303,0.018749999999999999,-119.06314203216327,-189.40210721382707,308.46524924599026,0.018800000000000001,-114.53348171082409,-193.25583532365664,307.78931703448075,0.018850000000000002,-109.97556196667375,-197.0618804478695,307.03744241454325,0.0189,-105.39050739820833,-200.81930350178158,306.20981089998992,0.018950000000000002,-100.7794492990339,-204.52717739747879,305.30662669651269,0.019,-96.143525378740719,-208.18458727255862,304.32811265129931,0.019050000000000001,-91.483879482186239,-211.79063071586216,303.2745101980484,0.019100000000000002,-86.801661307272482,-215.34441799012765,302.14607929740004,0.01915,-82.098026121272312,-218.84507225152171,300.94309837279405,0.019200000000000002,-77.374134475785823,-222.29172976598684,299.66586424177262,0.01925,-72.631151920391474,-225.6835401223548,298.31469204274629,0.019300000000000001,-67.870248715064022,-229.01966644217282,296.88991515723683,0.019350000000000003,-63.092599541430197,-232.29928558619127,295.39188512762138,0.019400000000000001,-58.299383212934892,-235.52158835745968,293.82097157039459,0.019450000000000002,-53.491782383983647,-238.68577970098653,292.17756208497019,0.0195,-48.670983258144418,-241.79107889990382,290.46206215804824,0.019550000000000001,-43.838175295465255,-244.83671976810047,288.67489506356571,0.019599999999999999,-38.994550918997177,-247.82195083926445,286.81650175826167,0.019650000000000001,-34.141305220577287,-250.74603555229865,284.88734077287592,0.019700000000000002,-29.279635665961532,-253.60825243305376,282.8878880990153,0.01975,-24.410741799366342,-256.40789527234244,280.81863707170879,0.019800000000000002,-19.535824947497652,-259.14427330018668,278.68009824768433,0.01985,-14.656087923143993,-261.81671135625282,276.47279927939684,0.019900000000000001,-9.7727347283990476,-264.42455005643961,274.1972847848387,0.019950000000000002,-4.8869702575921634,-266.96714595556949,271.85411621316166,0.02,0,-269.44387170614965,269.44387170614976};

//int vect[6];

#pragma DATA_SECTION(vect,"CpuToCla1MsgRAM");
float vect [6];

//-------------------------------------------//
//---------------Variables-FSM---------------//
#pragma DATA_SECTION(adc_read,"Cla1ToCpuMsgRAM");
float adc_read [8];
//-------------------------------------------//
//------------variables-srf-pll--------------//
#pragma DATA_SECTION(theta_l,"CpuToCla1MsgRAM");
float theta_l;
#pragma DATA_SECTION(theta_ant_l,"CpuToCla1MsgRAM");
float theta_ant_l;
#pragma DATA_SECTION(integrador_ant_l,"CpuToCla1MsgRAM");
float integrador_ant_l;
#pragma DATA_SECTION(integrador_l,"CpuToCla1MsgRAM");
float integrador_l;

#pragma DATA_SECTION(integrador_g,"Cla1ToCpuMsgRAM");
float integrador_g;
#pragma DATA_SECTION(theta_g,"Cla1ToCpuMsgRAM");
float theta_g;
#pragma DATA_SECTION(theta_ant_g,"Cla1ToCpuMsgRAM");
float theta_ant_g;
#pragma DATA_SECTION(integrador_ant_g,"Cla1ToCpuMsgRAM");
float integrador_ant_g;
//-------------------------------------------//
//-----------variables-DDSRFpll--------------//
#pragma DATA_SECTION(vg_d_men_prom_l,"CpuToCla1MsgRAM");
float vg_d_men_prom_l;
#pragma DATA_SECTION(vg_q_men_prom_l,"CpuToCla1MsgRAM");
float vg_q_men_prom_l;
#pragma DATA_SECTION(vg_d_mas_prom_l,"CpuToCla1MsgRAM");
float vg_d_mas_prom_l;
#pragma DATA_SECTION(vg_q_mas_prom_l,"CpuToCla1MsgRAM");
float vg_q_mas_prom_l;

#pragma DATA_SECTION(vg_d_men_ref_ant_l,"CpuToCla1MsgRAM");
float vg_d_men_ref_ant_l;
#pragma DATA_SECTION(vg_d_men_prom_ant_l,"CpuToCla1MsgRAM");
float vg_d_men_prom_ant_l;
#pragma DATA_SECTION(vg_q_men_ref_ant_l,"CpuToCla1MsgRAM");
float vg_q_men_ref_ant_l;
#pragma DATA_SECTION(vg_q_men_prom_ant_l,"CpuToCla1MsgRAM");
float vg_q_men_prom_ant_l;

#pragma DATA_SECTION(vg_d_mas_ref_ant_l,"CpuToCla1MsgRAM");
float vg_d_mas_ref_ant_l;
#pragma DATA_SECTION(vg_d_mas_prom_ant_l,"CpuToCla1MsgRAM");
float vg_d_mas_prom_ant_l;
#pragma DATA_SECTION(vg_q_mas_ref_ant_l,"CpuToCla1MsgRAM");
float vg_q_mas_ref_ant_l;
#pragma DATA_SECTION(vg_q_mas_prom_ant_l,"CpuToCla1MsgRAM");
float vg_q_mas_prom_ant_l;

#pragma DATA_SECTION(integr_ddsrf_l,"CpuToCla1MsgRAM");
float integr_ddsrf_l;
#pragma DATA_SECTION(integr_ddsrf_ant_l,"CpuToCla1MsgRAM");
float integr_ddsrf_ant_l;
#pragma DATA_SECTION(theta_ddsrf_ant_l,"CpuToCla1MsgRAM");
float theta_ddsrf_ant_l;
#pragma DATA_SECTION(theta_ddsrf_l,"CpuToCla1MsgRAM");
float theta_ddsrf_l;


#pragma DATA_SECTION(vg_d_men_prom_g,"Cla1ToCpuMsgRAM");
float vg_d_men_prom_g;
#pragma DATA_SECTION(vg_q_men_prom_g,"Cla1ToCpuMsgRAM");
float vg_q_men_prom_g;
#pragma DATA_SECTION(vg_d_mas_prom_g,"Cla1ToCpuMsgRAM");
float vg_d_mas_prom_g;
#pragma DATA_SECTION(vg_q_mas_prom_g,"Cla1ToCpuMsgRAM");
float vg_q_mas_prom_g;

#pragma DATA_SECTION(vg_d_men_ref_ant_g,"Cla1ToCpuMsgRAM");
float vg_d_men_ref_ant_g;
#pragma DATA_SECTION(vg_d_men_prom_ant_g,"Cla1ToCpuMsgRAM");
float vg_d_men_prom_ant_g;
#pragma DATA_SECTION(vg_q_men_ref_ant_g,"Cla1ToCpuMsgRAM");
float vg_q_men_ref_ant_g;
#pragma DATA_SECTION(vg_q_men_prom_ant_g,"Cla1ToCpuMsgRAM");
float vg_q_men_prom_ant_g;

#pragma DATA_SECTION(vg_d_mas_ref_ant_g,"Cla1ToCpuMsgRAM");
float vg_d_mas_ref_ant_g;
#pragma DATA_SECTION(vg_d_mas_prom_ant_g,"Cla1ToCpuMsgRAM");
float vg_d_mas_prom_ant_g;
#pragma DATA_SECTION(vg_q_mas_ref_ant_g,"Cla1ToCpuMsgRAM");
float vg_q_mas_ref_ant_g;
#pragma DATA_SECTION(vg_q_mas_prom_ant_g,"Cla1ToCpuMsgRAM");
float vg_q_mas_prom_ant_g;

#pragma DATA_SECTION(integr_ddsrf_g,"Cla1ToCpuMsgRAM");
float integr_ddsrf_g;
#pragma DATA_SECTION(integr_ddsrf_ant_g,"Cla1ToCpuMsgRAM");
float integr_ddsrf_ant_g;
#pragma DATA_SECTION(theta_ddsrf_ant_g,"Cla1ToCpuMsgRAM");
float theta_ddsrf_ant_g;
#pragma DATA_SECTION(theta_ddsrf_g,"Cla1ToCpuMsgRAM");
float theta_ddsrf_g;

//    vg_d_men_prom_l = vg_d_men_prom_g; // las l cpu->cla, las g cla->cpu
//    vg_q_men_prom_l = vg_q_men_prom_g;
//    vg_d_mas_prom_l = vg_d_mas_prom_g;
//    vg_q_mas_prom_l = vg_q_mas_prom_g;
//
//    vg_d_men_ref_ant_l = vg_d_men_ref_ant_g;
//    vg_d_men_prom_ant_l = vg_d_men_prom_ant_g;
//    vg_q_men_ref_ant_l = vg_q_men_ref_ant_g;
//    vg_q_men_prom_ant_l = vg_q_men_prom_ant_g;
//
//    vg_d_mas_ref_ant_l = vg_d_mas_ref_ant_g;
//    vg_d_mas_prom_ant_l = vg_d_mas_prom_ant_g;
//    vg_q_mas_ref_ant_l = vg_q_mas_ref_ant_g;
//    vg_q_mas_prom_ant_l = vg_q_mas_prom_ant_g;
////-------------------------------------------//
////------------variables-pi-pll---------------//
//    integr_ddsrf_l = integr_ddsrf_g
//    integr_ddsrf_ant_l = integr_ddsrf_ant_g;
//    theta_ddsrf_ant_l = theta_ddsrf_ant_g;
//    theta_ddsrf_l = theta_ddsrf_g;
////-------------------------------------------//

//----------Controlador-de-voltaje-----------//
#pragma DATA_SECTION(x_ant_v_l,"CpuToCla1MsgRAM");
float x_ant_v_l;
#pragma DATA_SECTION(x_ant_v_g,"Cla1ToCpuMsgRAM");
float x_ant_v_g;
#pragma DATA_SECTION(x_v_l,"CpuToCla1MsgRAM");
float x_v_l;
#pragma DATA_SECTION(x_v_g,"Cla1ToCpuMsgRAM");
float x_v_g;
//-------------------------------------------//

//---------Controlador-de-corriente-d--------//
#pragma DATA_SECTION(x_ant_id_l,"CpuToCla1MsgRAM");
float x_ant_id_l;
#pragma DATA_SECTION(x_ant_id_g,"Cla1ToCpuMsgRAM");
float x_ant_id_g;

#pragma DATA_SECTION(x_id_l,"CpuToCla1MsgRAM");
float x_id_l;
#pragma DATA_SECTION(x_id_g,"Cla1ToCpuMsgRAM");
float x_id_g;
//-------------------------------------------//

//---------Controlador-de-corriente-q--------//
#pragma DATA_SECTION(x_ant_iq_l,"CpuToCla1MsgRAM");
float x_ant_iq_l;
#pragma DATA_SECTION(x_ant_iq_g,"Cla1ToCpuMsgRAM");
float x_ant_iq_g;

#pragma DATA_SECTION(x_iq_l,"CpuToCla1MsgRAM");
float x_iq_l;
#pragma DATA_SECTION(x_iq_g,"Cla1ToCpuMsgRAM");
float x_iq_g;
//-------------------------------------------//
//--------------dq-a-alpha_beta--------------//

//-------------------------------------------//
//--------------alpha_beta-a-abc-------------//
#pragma DATA_SECTION(v_conv_a,"Cla1ToCpuMsgRAM");
float v_conv_a;
#pragma DATA_SECTION(v_conv_b,"Cla1ToCpuMsgRAM");
float v_conv_b;
#pragma DATA_SECTION(v_conv_c,"Cla1ToCpuMsgRAM");
float v_conv_c;
//-------------------------------------------//
//--------------Buffer-ant-falla-------------//
//uint16_t largo_theta = 1000;
float AdcBuf_ant_fall[ADC_BUF_PREV];
//uint16_t k = 0;
//-------------------------------------------//
//--------------Buffer-dsp-falla-------------//
uint16_t SampleCount;
uint16_t AdcBuf_dsp_fall[ADC_BUF_LEN];
uint16_t i = 0;
//-------------------------------------------//
//----------Variables-guardado-datos---------//
#define largo_theta 1300
float theta_buff[largo_theta];
float alfa_buff[largo_theta];
float beta_buff[largo_theta];
//-------------------------------------------//


//
// Function Prototypes
//
void CLA_configClaMemory(void);
void configCLAMemory2(void);
void CLA_initCpu1Cla1(void);
void EPWM_initEpwm(void);
void ADC_initAdcA(void);
void SetupADCEpwm2(void);
void SetupSOC(Uint16 soc, Uint16 channel, Uint16 acqps, Uint16 trigsel);
void estado_fallas(void);
void corrimiento_izq(float v1, float v2, float v3, float v4, float v5, float v6, float v7, float v8);

__interrupt void cla1Isr1();
__interrupt void cla1Isr2();
__interrupt void cla1Isr3();
__interrupt void cla1Isr4();
__interrupt void cla1Isr5();
__interrupt void cla1Isr6();
__interrupt void cla1Isr7();
__interrupt void cla1Isr8();

//
// Start of main
//
void main(void)
{
// Step 1. Initialize System Control:
// PLL, WatchDog, enable Peripheral Clocks
// This example function is found in the F2837xD_SysCtrl.c file.
//
    InitSysCtrl();
//
// Step 2. enable PWM1 and PWM2 and their GPIOs
//
    CpuSysRegs.PCLKCR2.bit.EPWM1 = 1;
    CpuSysRegs.PCLKCR2.bit.EPWM2 = 1;
    CpuSysRegs.PCLKCR2.bit.EPWM3 = 1;
    CpuSysRegs.PCLKCR2.bit.EPWM4 = 1;
//
// For this case just init GPIO pins for ePWM1, ePWM2
// These functions are in the F2837xD_EPwm.c file
//
    InitEPwm1Gpio();
    InitEPwm2Gpio();
    InitEPwm3Gpio();
    InitEPwm4Gpio();

//  Encendido y apagado de un led
    InitGpio();
    GPIO_SetupPinMux(BLINKY_LED_GPIO, GPIO_MUX_CPU1, 0);
    GPIO_SetupPinOptions(BLINKY_LED_GPIO, GPIO_OUTPUT, GPIO_PUSHPULL);


    //
// Step 3. Clear all interrupts and initialize PIE vector table:
// Disable CPU interrupts
//
    DINT;
//
// Initialize the PIE control registers to their default state.
// The default state is all PIE interrupts disabled and flags
// are cleared.
// This function is found in the F2837xD_PieCtrl.c file.
//
    InitPieCtrl();
//
// Disable CPU interrupts and clear all CPU interrupt flags:
//
    IER = 0x0000;
    IFR = 0x0000;
//
// Initialize the PIE vector table with pointers to the shell Interrupt
// Service Routines (ISR).
// This will populate the entire table, even if the interrupt
// is not used in this example.  This is useful for debug purposes.
// The shell ISR routines are found in F2837xD_DefaultIsr.c.
// This function is found in F2837xD_PieVect.c.
//
    InitPieVectTable();
//
//
// Step 5. Configure the ADC to start sampling on an EPWM period
//
    ADC_initAdcA();
//
// Step 6. Configure EPWM to trigger ADC every 20us
//
    EPWM_initEpwm();
//
// Configurar los ADC para ser disparados con el ePWM
//
    SetupADCEpwm2();
//
// Step 7. Enable global Interrupts and higher priority real-time debug events:
//
    EINT;  // Enable Global interrupt INTM
    ERTM;  // Enable Global realtime interrupt DBGM

//
// Step 8. Turn on the EPWM
//
    EALLOW;
    CpuSysRegs.PCLKCR0.bit.TBCLKSYNC = 1;
    EPwm1Regs.ETSEL.bit.SOCAEN  = 1; // Habilita pulso SOCA  (EPWMxSOCA)
    EPwm1Regs.ETSEL.bit.SOCBEN  = 1; // Habilita pulso SOCB  (EPWMxSOCB)
    EPwm1Regs.TBCTL.bit.CTRMODE = 2; // Contador entra en up-down count mode

    EPwm2Regs.TBCTL.bit.CTRMODE = 2; // Contador entra en up-down count mode
    EPwm3Regs.TBCTL.bit.CTRMODE = 2;
    EPwm4Regs.TBCTL.bit.CTRMODE = 2;
    EDIS;

// Configure the CLA memory spaces first followed by
// the CLA task vectors.
    configCLAMemory2();
    CLA_initCpu1Cla1();
//  Initial parameters
    theta_l          = 0;
    theta_ant_l      = 0;
    integrador_ant_l = 0;
    integrador_l     = 0;
    theta_g          = 0;
    theta_ant_g      = 0;
    integrador_ant_g = 0;
    integrador_g     = 0;
    voltFilt         = 0;

//    valores_2[1];
//    vect[0] = valores_2[1];
//    vect[1] = valores_2[2];
//    vect[2] = valores_2[3];


//----------Controlador-de-voltaje-----------//
    x_v_l       = 0;
    x_ant_v_l   = 0;
    x_id_l      = 0;
    x_ant_id_l  = 0;
    x_ant_iq_l  = 0;
//------------------------------------------//
//---------Controlador-de-corriente-d--------//
    x_ant_id_l = 0;
//------------------------------------------//
//---------Controlador-de-corriente-q--------//
    x_ant_iq_l = 0;
//------------------------------------------//
    boton_1 = 1;
    while(1)
        {

//        GPIO_WritePin(BLINKY_LED_GPIO, 1);
////        DELAY_US(1000*500);
//        Cla1ForceTask6();

            switch (estado)
            {
                    case idle:
                        sw1 = 0;
                        sw2 = 0;
                        if (boton_1 == 1)
                        {
                            estado = sync_pll;
                        }
                    break;
                    case sync_pll:
                        estado_fallas();
                        sw1 = 0;
                        sw2 = 0;
                        if(1 == AdcaRegs.ADCINTOVF.bit.ADCINT1)    // Revisa si ocurrió overflow
                        {
                            AdcaRegs.ADCINTOVFCLR.bit.ADCINT1 = 1; // limpia INT1 overflow flag
                            AdcaRegs.ADCINTFLGCLR.bit.ADCINT1 = 1; //Re-clear ADCINT flag
                        }
                        PieCtrlRegs.PIEACK.all = (PIEACK_GROUP1 | PIEACK_GROUP11);


                        if (DmaClaSrcSelRegs.CLA1TASKSRCSEL1.bit.TASK2 == 0)
                        {
                            EALLOW;
                            DmaClaSrcSelRegs.CLA1TASKSRCSEL1.bit.TASK2 = 1;
                            DmaClaSrcSelRegs.CLA1TASKSRCSEL2.bit.TASK7 = 0;
                            EDIS;
                        }
                        if ((vg_q1 > -1)&(vg_q1 <1))
                        {
                            estado = pre_charge;
                            vg_q1 = 10;
                        }
                    break;
                    case pre_charge:
                        estado_fallas();
                        sw1 = 1;
                        sw2 = 0;
                        if(1 == AdcaRegs.ADCINTOVF.bit.ADCINT1)    // Revisa si ocurrió overflow
                        {
                            AdcaRegs.ADCINTOVFCLR.bit.ADCINT1 = 1; // limpia INT1 overflow flag
                            AdcaRegs.ADCINTFLGCLR.bit.ADCINT1 = 1; //Re-clear ADCINT flag
                        }
                        PieCtrlRegs.PIEACK.all = (PIEACK_GROUP1 | PIEACK_GROUP11);
                        if (fault == 1)
                        {
                            estado = fault_mode;
                        }

                        if ((vdc_2 > 528)&(fault == 0))
                        {
                            estado = normal_mode;
                        }
                    break;
                    case normal_mode:
                        estado_fallas();
                        sw1 = 1;
                        sw2 = 1;
//                        if(1 == AdcaRegs.ADCINTOVF.bit.ADCINT1)    // Revisa si ocurrió overflow
//                        {
//                            AdcaRegs.ADCINTOVFCLR.bit.ADCINT1 = 1; // limpia INT1 overflow flag
//                            AdcaRegs.ADCINTFLGCLR.bit.ADCINT1 = 1; //Re-clear ADCINT flag
//                        }
//                        PieCtrlRegs.PIEACK.all = (PIEACK_GROUP1 | PIEACK_GROUP11);

                        if (DmaClaSrcSelRegs.CLA1TASKSRCSEL2.bit.TASK7 == 0)
                        {
                            EALLOW;
                            DmaClaSrcSelRegs.CLA1TASKSRCSEL1.bit.TASK2 = 0;
                            DmaClaSrcSelRegs.CLA1TASKSRCSEL2.bit.TASK7 = 1;
                            EDIS;
                        }
                        if (fault == 1)
                        {
                            estado = fault_mode;
                        }
                        if ((boton_2 == 1)&(fault == 0))
                        {
                            estado = apagado;
                            boton_2 = 0;
                            EALLOW;
                            DmaClaSrcSelRegs.CLA1TASKSRCSEL2.bit.TASK7 = 0;
                            EDIS;
                        }
                    break;
                    case apagado:
                        sw1 = 0;
                        sw2 = 0;
                        DELAY_US(1000000); //DELAY_US(5000000);
                        estado = idle;
                    break;
                    case fault_mode:
                        if(1 == AdcaRegs.ADCINTOVF.bit.ADCINT1)    // Revisa si ocurrió overflow
                        {
                            AdcaRegs.ADCINTOVFCLR.bit.ADCINT1 = 1; // limpia INT1 overflow flag
                            AdcaRegs.ADCINTFLGCLR.bit.ADCINT1 = 1; // Re-clear ADCINT flag
                        }
                        PieCtrlRegs.PIEACK.all = (PIEACK_GROUP1 | PIEACK_GROUP11);

                        if (DmaClaSrcSelRegs.CLA1TASKSRCSEL1.bit.TASK1 == 0)
                        {
                            EALLOW;
                            DmaClaSrcSelRegs.CLA1TASKSRCSEL1.bit.TASK1 = 1;
                            DmaClaSrcSelRegs.CLA1TASKSRCSEL1.bit.TASK2 = 0;
                            DmaClaSrcSelRegs.CLA1TASKSRCSEL2.bit.TASK7 = 0;
                            EDIS;
                        }
                        if (fault == 0)
                        {
                            estado = apagado;
                            EALLOW;
                            DmaClaSrcSelRegs.CLA1TASKSRCSEL1.bit.TASK1 = 0;
                            EDIS;
                        }
                    break;

                    default:
                    break;

            }
        }
}

//
// CLA_configClaMemory - Configure CLA memory sections
//
void CLA_configClaMemory(void)
{
    extern uint32_t Cla1funcsRunStart, Cla1funcsLoadStart, Cla1funcsLoadSize;

    EALLOW;
#ifdef _FLASH
    //
    // Copy over code from FLASH to RAM
    //
    memcpy((uint32_t *)&Cla1funcsRunStart, (uint32_t *)&Cla1funcsLoadStart,
           (uint32_t)&Cla1funcsLoadSize);
#endif //_FLASH

    //
    // Initialize and wait for CLA1ToCPUMsgRAM
    //
    MemCfgRegs.MSGxINIT.bit.INIT_CLA1TOCPU = 1;
    while(MemCfgRegs.MSGxINITDONE.bit.INITDONE_CLA1TOCPU != 1){};

    //
    // Initialize and wait for CPUToCLA1MsgRAM
    //
    MemCfgRegs.MSGxINIT.bit.INIT_CPUTOCLA1 = 1;
    while(MemCfgRegs.MSGxINITDONE.bit.INITDONE_CPUTOCLA1 != 1){};

    //
    // Select LS5RAM to be the programming space for the CLA
    // First configure the CLA to be the master for LS5 and then
    // set the space to be a program block
    //
    MemCfgRegs.LSxMSEL.bit.MSEL_LS4 = 1;
    MemCfgRegs.LSxCLAPGM.bit.CLAPGM_LS4 = 1;

    MemCfgRegs.LSxMSEL.bit.MSEL_LS5 = 1;
    MemCfgRegs.LSxCLAPGM.bit.CLAPGM_LS5 = 1;

    //
    // Next configure LS0RAM and LS1RAM as data spaces for the CLA
    // First configure the CLA to be the master for LS0(1) and then
    // set the spaces to be code blocks
    //
    MemCfgRegs.LSxMSEL.bit.MSEL_LS0 = 1;
    MemCfgRegs.LSxCLAPGM.bit.CLAPGM_LS0 = 0;

    MemCfgRegs.LSxMSEL.bit.MSEL_LS1 = 1;
    MemCfgRegs.LSxCLAPGM.bit.CLAPGM_LS1 = 0;

    EDIS;
}

void configCLAMemory2(void)
{
#ifdef _FLASH
    //
    // Copy over code and tables from FLASH to RAM
    //
    memcpy(&RamfuncsRunStart, &RamfuncsLoadStart, (uint32_t)&RamfuncsLoadSize);
    memcpy((uint32_t *)&Cla1ProgRunStart, (uint32_t *)&Cla1ProgLoadStart,
            (uint32_t)&Cla1ProgLoadSize);

#if !(CLA_MATH_TABLES_IN_ROM)
    //
    // Copy over CLA Math tables from FLASH to RAM
    //
    memcpy((uint32_t *)&CLA1mathTablesRunStart, (uint32_t *)&CLA1mathTablesLoadStart,
            (uint32_t)&CLA1mathTablesLoadSize);
#endif
#endif

    EALLOW;
    //
    // Perform RAM initialization on the message RAMs
    //
    MemCfgRegs.MSGxINIT.bit.INIT_CLA1TOCPU = 1;
    while(MemCfgRegs.MSGxINITDONE.bit.INITDONE_CLA1TOCPU != 1)
    {
    }
    MemCfgRegs.MSGxINIT.bit.INIT_CPUTOCLA1 = 1;
    while(MemCfgRegs.MSGxINITDONE.bit.INITDONE_CPUTOCLA1 != 1)
    {
    }
    //
    // Select LS0RAM and LS1RAM to be program space for the CLA
    // First, configure the CLA to be the master for LS0 and LS1
    // Second, set the space to be a program block
    //
    MemCfgRegs.LSxMSEL.bit.MSEL_LS0 = 1;
    MemCfgRegs.LSxCLAPGM.bit.CLAPGM_LS0 = 1;

    MemCfgRegs.LSxMSEL.bit.MSEL_LS1 = 1;
    MemCfgRegs.LSxCLAPGM.bit.CLAPGM_LS1 = 1;
    //
    // Configure RAM blocks LS2-LS5 as data spaces for the CLA
    // First, configure the CLA to be the master for LSx
    // Second, set the spaces to be code blocks
    //
    MemCfgRegs.LSxMSEL.bit.MSEL_LS2 = 1;
    MemCfgRegs.LSxCLAPGM.bit.CLAPGM_LS2 = 0;

    MemCfgRegs.LSxMSEL.bit.MSEL_LS3 = 1;
    MemCfgRegs.LSxCLAPGM.bit.CLAPGM_LS3 = 0;

    MemCfgRegs.LSxMSEL.bit.MSEL_LS4 = 1;
    MemCfgRegs.LSxCLAPGM.bit.CLAPGM_LS4 = 0;

    MemCfgRegs.LSxMSEL.bit.MSEL_LS5 = 1;
    MemCfgRegs.LSxCLAPGM.bit.CLAPGM_LS5 = 0;

    EDIS;
}

//
// CLA_initCpu1Cla1 - Initialize CLA1 task vectors and end of task interrupts
//
void CLA_initCpu1Cla1(void)
{
    //
    // Compute all CLA task vectors
    // On Type-1 CLAs the MVECT registers accept full 16-bit task addresses as
    // opposed to offsets used on older Type-0 CLAs
    //
    EALLOW;
    Cla1Regs.MVECT1 = (uint16_t)(&Cla1Task1);
    Cla1Regs.MVECT2 = (uint16_t)(&Cla1Task2);
    Cla1Regs.MVECT3 = (uint16_t)(&Cla1Task3);
    Cla1Regs.MVECT4 = (uint16_t)(&Cla1Task4);
    Cla1Regs.MVECT5 = (uint16_t)(&Cla1Task5);
    Cla1Regs.MVECT6 = (uint16_t)(&Cla1Task6);
    Cla1Regs.MVECT7 = (uint16_t)(&Cla1Task7);
    Cla1Regs.MVECT8 = (uint16_t)(&Cla1Task8);
    //
    // Enable the IACK instruction to start a task on CLA in software
    // for all  8 CLA tasks. Also, globally enable all 8 tasks (or a
    // subset of tasks) by writing to their respective bits in the
    // MIER register
    //
    Cla1Regs.MCTL.bit.IACKE = 1;
//    Cla1Regs.MIER.all = (M_INT8 | M_INT7| M_INT6| M_INT5| M_INT4| M_INT3| M_INT2| M_INT1);
    Cla1Regs.MIER.bit.INT1 = 1;     // Permite que interrupciones o cpu inicien la tarea 1
    Cla1Regs.MIER.bit.INT2 = 1;     // Permite que interrupciones o cpu inicien la tarea 2
    Cla1Regs.MIER.bit.INT6 = 1;     // Permite que interrupciones o cpu inicien la tarea 6
    Cla1Regs.MIER.bit.INT7 = 1;     // Permite que interrupciones o cpu inicien la tarea 7

    //
    // Configure the vectors for the end-of-task interrupt for all
    // 8 tasks
    //
    PieVectTable.CLA1_1_INT = &cla1Isr1;
    PieVectTable.CLA1_2_INT = &cla1Isr2;
    PieVectTable.CLA1_3_INT = &cla1Isr3;
    PieVectTable.CLA1_4_INT = &cla1Isr4;
    PieVectTable.CLA1_5_INT = &cla1Isr5;
    PieVectTable.CLA1_6_INT = &cla1Isr6;
    PieVectTable.CLA1_7_INT = &cla1Isr7;
    PieVectTable.CLA1_8_INT = &cla1Isr8;
    //
    // Set the adca.1 as the trigger for task 7
    //
//    DmaClaSrcSelRegs.CLA1TASKSRCSEL2.bit.TASK7 = 0;
//    DmaClaSrcSelRegs.CLA1TASKSRCSEL1.bit.TASK2 = 0;    // 1=ADCAINT1   9=ADCBINT4  17=ADCDINT2  33=XINT5     43=EPWM8INT   71=MXEVTA    79=ECAP5INT   96=SD2INT

//--- Select Task interrupt source                     /******** TRIGGER SOURCE FOR EACH TASK (unlisted numbers are reserved) ********/
    DmaClaSrcSelRegs.CLA1TASKSRCSEL1.bit.TASK1 = 0;    // 0=none       8=ADCBINT3  16=ADCDINT1  32=XINT4     42=EPWM7INT   70=TINT2     78=ECAP4INT   95=SD1INT     114=SPIRXINTC
    DmaClaSrcSelRegs.CLA1TASKSRCSEL1.bit.TASK2 = 0;    // 1=ADCAINT1   9=ADCBINT4  17=ADCDINT2  33=XINT5     43=EPWM8INT   71=MXEVTA    79=ECAP5INT   96=SD2INT
    DmaClaSrcSelRegs.CLA1TASKSRCSEL1.bit.TASK3 = 0;    // 2=ADCAINT2  10=ADCBEVT   18=ADCDINT3  36=EPWM1INT  44=EPWM9INT   72=MREVTA    80=ECAP6INT  107=UPP1INT
    DmaClaSrcSelRegs.CLA1TASKSRCSEL1.bit.TASK4 = 0;    // 3=ADCAINT3  11=ADCCINT1  19=ADCDINT4  37=EPWM2INT  45=EPWM10INT  73=MXEVTB    83=EQEP1INT  109=SPITXINTA
    DmaClaSrcSelRegs.CLA1TASKSRCSEL2.bit.TASK5 = 0;    // 4=ADCAINT4  12=ADCCINT2  20=ADCDEVT   38=EPWM3INT  46=EPWM11INT  74=MREVTB    84=EQEP2INT  110=SPIRXINTA
    DmaClaSrcSelRegs.CLA1TASKSRCSEL2.bit.TASK6 = 0;    // 5=ADCAEVT   13=ADCCINT3  29=XINT1     39=EPWM4INT  47=EPWM12INT  75=ECAP1INT  85=EQEP3INT  111=SPITXINTB
    DmaClaSrcSelRegs.CLA1TASKSRCSEL2.bit.TASK7 = 0;    // 6=ADCBINT1  14=ADCCINT4  30=XINT2     40=EPWM5INT  48=TINT0      76=ECAP2INT  87=HRCAP1INT 112=SPIRXINTB
    DmaClaSrcSelRegs.CLA1TASKSRCSEL2.bit.TASK8 = 0;    // 7=ADCBINT2  15=ADCCEVT   31=XINT3     41=EPWM6INT  69=TINT1      77=ECAP3INT  88=HRCAP2INT 113=SPITXINTC

    DmaClaSrcSelRegs.CLA1TASKSRCSELLOCK.bit.CLA1TASKSRCSEL1 = 0;     // Write a 1 to lock (cannot be cleared once set)
    DmaClaSrcSelRegs.CLA1TASKSRCSELLOCK.bit.CLA1TASKSRCSEL2 = 0;     // Write a 1 to lock (cannot be cleared once set)

    //
    // Enable all CLA interrupts at the group and subgroup levels
    //
    PieCtrlRegs.PIEIER11.all = 0xFFFF;
    IER |= (M_INT11 );
    EDIS;
}
//
// EPWM_initEpwm - Initialize EPWM1, EPWM2, EPWM3, EPWM4 settings
//
void EPWM_initEpwm(void)
{
    EALLOW;
    EPwm1Regs.ETSEL.bit.SOCAEN    = 0;    // Deshabilita el inicio de la conversión del ADC
    EPwm1Regs.ETSEL.bit.SOCASEL   = 1;    // Genera Evento cuando TBCTR = 0x00 (inicio conversión)
    EPwm1Regs.ETSEL.bit.SOCBEN    = 0;    // Deshabilita el inicio de la conversión del ADC
    EPwm1Regs.ETSEL.bit.SOCBSEL   = 1;    // Genera Evento cuando TBCTR = 0x00 (inicio conversión)
    EPwm1Regs.ETPS.bit.SOCAPRD    = 1;    // Genera el pulso en el 1st evento
    EPwm1Regs.ETPS.bit.SOCBPRD    = 1;    // Genera el pulso en el 1st evento
    EPwm1Regs.TBPRD               = 500;  // Frecuencia de 50khz
//    EPwm1Regs.TBPRD               = 50000;  // Frecuencia de .5khz
    EPwm1Regs.TBCTL.bit.CTRMODE   = 3;    // freeze counter
    EPwm1Regs.TBCTL.bit.HSPCLKDIV = 0x1;  // Divide el reloj en 2
    EPwm1Regs.TBCTL.bit.CLKDIV    = 0x0;  // Divide el reloj en 1

    EPwm1Regs.CMPA.bit.CMPA = 250;
    EPwm1Regs.AQCTLA.bit.CAU = AQ_SET;              // Set PWM1A on Zero
    EPwm1Regs.AQCTLA.bit.CAD = AQ_CLEAR;
    EPwm1Regs.AQCTLB.bit.CAU = AQ_CLEAR;            // Set PWM1B on Zero
    EPwm1Regs.AQCTLB.bit.CAD = AQ_SET;
//
// Configuracion Deadband - 500ns de FED y RED
    EPwm1Regs.DBCTL.bit.OUT_MODE = DB_FULL_ENABLE;
    EPwm1Regs.DBCTL.bit.POLSEL = DB_ACTV_HIC;
    EPwm1Regs.DBCTL.bit.IN_MODE = DBA_ALL;
    EPwm1Regs.DBRED.bit.DBRED = 0x19; // 25 decimal
    EPwm1Regs.DBFED.bit.DBFED = 0x19; // 25 decimal

    // Configuración eWPM2
    EPwm2Regs.ETPS.bit.SOCAPRD    = 1;    // Genera el pulso en el 1st evento
    EPwm2Regs.ETPS.bit.SOCBPRD    = 1;    // Genera el pulso en el 1st evento
    EPwm2Regs.TBPRD               = 500;  // Frecuencia de 50khz
    EPwm2Regs.TBCTL.bit.CTRMODE   = 3;    // freeze counter
    EPwm2Regs.TBCTL.bit.HSPCLKDIV = 0x1;  // Divide el reloj en 2
    EPwm2Regs.TBCTL.bit.CLKDIV    = 0x0;  // Divide el reloj en 1

    EPwm2Regs.CMPA.bit.CMPA = 250;
    EPwm2Regs.AQCTLA.bit.CAU = AQ_SET;              // Set PWM1A on Zero
    EPwm2Regs.AQCTLA.bit.CAD = AQ_CLEAR;
    EPwm2Regs.AQCTLB.bit.CAU = AQ_CLEAR;            // Set PWM1B on Zero
    EPwm2Regs.AQCTLB.bit.CAD = AQ_SET;
//
// Configuracion Deadband - 500ns de FED y RED
    EPwm3Regs.DBCTL.bit.OUT_MODE = DB_FULL_ENABLE;
    EPwm3Regs.DBCTL.bit.POLSEL = DB_ACTV_HIC;
    EPwm3Regs.DBCTL.bit.IN_MODE = DBA_ALL;
    EPwm3Regs.DBRED.bit.DBRED = 0x19; // 25 decimal
    EPwm3Regs.DBFED.bit.DBFED = 0x19; // 25 decimal

    // Configuración eWPM3
    EPwm3Regs.ETPS.bit.SOCAPRD    = 1;    // Genera el pulso en el 1st evento
    EPwm3Regs.ETPS.bit.SOCBPRD    = 1;    // Genera el pulso en el 1st evento
    EPwm3Regs.TBPRD               = 500;  // Frecuencia de 50khz
    EPwm3Regs.TBCTL.bit.CTRMODE   = 3;    // freeze counter
    EPwm3Regs.TBCTL.bit.HSPCLKDIV = 0x1;  // Divide el reloj en 2
    EPwm3Regs.TBCTL.bit.CLKDIV    = 0x0;  // Divide el reloj en 1

    EPwm3Regs.CMPA.bit.CMPA = 250;
    EPwm3Regs.AQCTLA.bit.CAU = AQ_SET;              // Set PWM1A on Zero
    EPwm3Regs.AQCTLA.bit.CAD = AQ_CLEAR;
    EPwm3Regs.AQCTLB.bit.CAU = AQ_CLEAR;            // Set PWM1B on Zero
    EPwm3Regs.AQCTLB.bit.CAD = AQ_SET;
//
// Configuracion Deadband - 500ns de FED y RED
    EPwm3Regs.DBCTL.bit.OUT_MODE = DB_FULL_ENABLE;
    EPwm3Regs.DBCTL.bit.POLSEL = DB_ACTV_HIC;
    EPwm3Regs.DBCTL.bit.IN_MODE = DBA_ALL;
    EPwm3Regs.DBRED.bit.DBRED = 0x19; // 25 decimal
    EPwm3Regs.DBFED.bit.DBFED = 0x19; // 25 decimal

    // Configuración eWPM4
    EPwm4Regs.ETPS.bit.SOCAPRD    = 1;    // Genera el pulso en el 1st evento
    EPwm4Regs.ETPS.bit.SOCBPRD    = 1;    // Genera el pulso en el 1st evento
    EPwm4Regs.TBPRD               = 500;  // Frecuencia de 50khz
    EPwm4Regs.TBCTL.bit.CTRMODE   = 3;    // freeze counter
    EPwm4Regs.TBCTL.bit.HSPCLKDIV = 0x1;  // Divide el reloj en 2
    EPwm4Regs.TBCTL.bit.CLKDIV    = 0x0;  // Divide el reloj en 1

    EPwm4Regs.CMPA.bit.CMPA = 250;
    EPwm4Regs.AQCTLA.bit.CAU = AQ_SET;              // Set PWM1A on Zero
    EPwm4Regs.AQCTLA.bit.CAD = AQ_CLEAR;
    EPwm4Regs.AQCTLB.bit.CAU = AQ_CLEAR;            // Set PWM1B on Zero
    EPwm4Regs.AQCTLB.bit.CAD = AQ_SET;
//
// Configuracion Deadband - 500ns de FED y RED
    EPwm4Regs.DBCTL.bit.OUT_MODE = DB_FULL_ENABLE;
    EPwm4Regs.DBCTL.bit.POLSEL = DB_ACTV_HIC;
    EPwm4Regs.DBCTL.bit.IN_MODE = DBA_ALL;
    EPwm4Regs.DBRED.bit.DBRED = 0x19; // 25 decimal
    EPwm4Regs.DBFED.bit.DBFED = 0x19; // 25 decimal
    EDIS;
}

//
// ADC_initAdcA - Initialize ADCA configurations and power it up
//
void ADC_initAdcA(void)
{
    EALLOW;
    //
    //write configurations
    //
    AdcaRegs.ADCCTL2.bit.PRESCALE = 6; //set ADCCLK divider to /4
    AdcSetMode(ADC_ADCA, ADC_RESOLUTION_12BIT, ADC_SIGNALMODE_SINGLE);
    //
    //Set pulse positions to late
    //
    AdcaRegs.ADCCTL1.bit.INTPULSEPOS = 1; // Interrupción se genera al final de la conversión
    //
    //power up the ADC
    //
    AdcaRegs.ADCCTL1.bit.ADCPWDNZ = 1; // Enciende el circuito análogo del ADC
    // encender adcB
    AdcbRegs.ADCCTL2.bit.PRESCALE = 6; //set ADCCLK divider to /4
    AdcSetMode(ADC_ADCB, ADC_RESOLUTION_12BIT, ADC_SIGNALMODE_SINGLE);
    //
    //Set pulse positions to late
    //
    AdcbRegs.ADCCTL1.bit.ADCPWDNZ = 1; // Enciende el circuito análogo del ADC
    //
    //delay for > 1ms to allow ADC time to power up
    DELAY_US(1000);
    EDIS;
}

void SetupADCEpwm2(void)
{
    Uint16 acqps;
//    acqps = 200; //1us -> (1e-6)/(5e-9), Mínimo son 75, set by ACQPS and  PERx.SYSCLK
    acqps = 800; //1us -> (1e-6)/(5e-9), Mínimo son 75, set by ACQPS and  PERx.SYSCLK

    EALLOW;
    SetupSOC(soc0, 0, acqps, 5); // SOC0 convierte ADC-A0 y hace trigger desde ePWM1(5) con una ventana de acqps
    SetupSOC(soc1, 1, acqps, 5); // SOC1 convierte ADC-A1 y hace trigger desde ePWM1(5) con una ventana de acqps
    SetupSOC(soc2, 2, acqps, 5); // SOC2 convierte ADC-A2 y hace trigger desde ePWM1(5) con una ventana de acqps
    SetupSOC(soc3, 3, acqps, 5); // SOC3 convierte ADC-A3 y hace trigger desde ePWM1(5) con una ventana de acqps
    SetupSOC(soc4, 4, acqps, 5); // SOC4 convierte ADC-A4 y hace trigger desde ePWM1(5) con una ventana de acqps
//    SetupSOC(soc5, 5, acqps, 5); // SOC5 convierte ADC-A5 y hace trigger desde ePWM1(5) con una ventana de acqps
    SetupSOC(soc6, 0, acqps, 5); // SOC6 convierte ADC-B0 y hace trigger desde ePWM1(5) con una ventana de acqps
    SetupSOC(soc7, 1, acqps, 5); // SOC7 convierte ADC-B1 y hace trigger desde ePWM1(5) con una ventana de acqps
    SetupSOC(soc8, 2, acqps, 5); // SOC8 convierte ADC-B2 y hace trigger desde ePWM1(5) con una ventana de acqps

    AdcaRegs.ADCINTSEL1N2.bit.INT1SEL = 4; //fin de SOC4 genera INT1 flag
    AdcaRegs.ADCINTSEL1N2.bit.INT1E = 1;   //Habilita INT1 flag
    AdcaRegs.ADCINTFLGCLR.bit.ADCINT1 = 1; //limpia el bit de INT1 flag
    EDIS;
}

void SetupSOC(Uint16 soc, Uint16 channel, Uint16 acqps, Uint16 trigsel)
{
    switch(soc)
        {
            case soc0:
            {
                AdcaRegs.ADCSOC0CTL.bit.CHSEL = channel;  //SOC0 will convert pin A0
                AdcaRegs.ADCSOC0CTL.bit.ACQPS = acqps;    //sample window
                AdcaRegs.ADCSOC0CTL.bit.TRIGSEL = trigsel;//trigger on ePWM1 SOCA/C
            break;
            }
            case soc1:
            {
                AdcaRegs.ADCSOC1CTL.bit.CHSEL = channel;  //SOC1 will convert pin A1
                AdcaRegs.ADCSOC1CTL.bit.ACQPS = acqps;    //sample window
                AdcaRegs.ADCSOC1CTL.bit.TRIGSEL = trigsel;//trigger on ePWM1 SOCA/C
            break;
            }
            case soc2:
            {
                AdcaRegs.ADCSOC2CTL.bit.CHSEL = channel;  //SOC2 will convert pin A2
                AdcaRegs.ADCSOC2CTL.bit.ACQPS = acqps;    //sample window
                AdcaRegs.ADCSOC2CTL.bit.TRIGSEL = trigsel;//trigger on ePWM1 SOCA/C
            break;
            }
            case soc3:
            {
                AdcaRegs.ADCSOC3CTL.bit.CHSEL = channel;  //SOC3 will convert pin A3
                AdcaRegs.ADCSOC3CTL.bit.ACQPS = acqps;    //sample window
                AdcaRegs.ADCSOC3CTL.bit.TRIGSEL = trigsel;//trigger on ePWM1 SOCA/C
            break;
            }
            case soc4:
            {
                AdcaRegs.ADCSOC4CTL.bit.CHSEL = channel;  //SOC4 will convert pin A4
                AdcaRegs.ADCSOC4CTL.bit.ACQPS = acqps;    //sample window
                AdcaRegs.ADCSOC4CTL.bit.TRIGSEL = trigsel;//trigger on ePWM1 SOCA/C
            break;
            }
            case soc5:
            {
                AdcaRegs.ADCSOC5CTL.bit.CHSEL = channel;  //SOC5 will convert pin A5
                AdcaRegs.ADCSOC5CTL.bit.ACQPS = acqps;    //sample window
                AdcaRegs.ADCSOC5CTL.bit.TRIGSEL = trigsel;//trigger on ePWM1 SOCA/C
            break;
            }
            case soc6:
            {
                AdcbRegs.ADCSOC6CTL.bit.CHSEL = channel;  //SOC6 will convert pin B0
                AdcbRegs.ADCSOC6CTL.bit.ACQPS = acqps;    //sample window
                AdcbRegs.ADCSOC6CTL.bit.TRIGSEL = trigsel;//trigger on ePWM1 SOCA/C
            break;
            }
            case soc7:
            {
                AdcbRegs.ADCSOC7CTL.bit.CHSEL = channel;  //SOC7 will convert pin B1
                AdcbRegs.ADCSOC7CTL.bit.ACQPS = acqps;    //sample window
                AdcbRegs.ADCSOC7CTL.bit.TRIGSEL = trigsel;//trigger on ePWM1 SOCA/C
            break;
            }
            case soc8:
            {
                AdcbRegs.ADCSOC8CTL.bit.CHSEL = channel;  //SOC8 will convert pin B2
                AdcbRegs.ADCSOC8CTL.bit.ACQPS = acqps;    //sample window
                AdcbRegs.ADCSOC8CTL.bit.TRIGSEL = trigsel;//trigger on ePWM1 SOCA/C
            break;
            }
        }
    }
void estado_fallas(void)
{
    fault = 0;
//    // estado sincronizacion del pll
//    int vg_d, vg_q;
//    int cont_sinc; // agregar al inicio del código
//    // estado precarga
//    float va, vb, vc;
//    int cont_precarg;
//    // estado normal mode
//    int cont_normal, cont_norm_fase;
//    float vdc;


    switch (estado)
    {
        case sync_pll:
            // sincronizacion del pll
            // Pll no se engancha
            // no hay alimentación
            if ((vg_d < vg_d_min)||(vg_q < vg_q_min)||(vg_q > vg_q_max))
            {
                cont_sinc ++;
            }
            else
            {
                cont_sinc = 0;
            }
            if (cont_sinc >= 150)
            {
                fault = 1;
            }
        break;
        case pre_charge:
            // Estado Precarga
            // No alcanza la precarga, o tarda más de lo necesario
            // problemas de voltaje en alguna fase, alguna pegada en 0 por mas de 10 ciclos
            // no hay alimentación
            va = (float)(AdcaResultRegs.ADCRESULT1);
            vb = (float)(AdcaResultRegs.ADCRESULT2);
            vc = (float)(AdcaResultRegs.ADCRESULT3);
            if (((va<v_phase_max) || (va>v_phase_min)) || ((vb<v_phase_max) || (vb>v_phase_min)) || ((vc<v_phase_max) || (vc>v_phase_min)))
            {
                cont_precarg++;
            }
            else
            {
                cont_precarg = 0;
            }
            if (cont_precarg >= 30)
            {
                fault = 1;
            }
        break;
        case normal_mode:
            // Estado trabajo normal
            // sobrecorriente, no se como probarlo
            // tensión elevada
            // tensión 0
            // problema en alguna fase
            // no hay alimentación
            // Medicion v*i out no debe superar los 5.5kw, 10% más de la potencia nominal.
            if (vdc > vdc_max)
            {
                cont_normal ++;
            }
            else
            {
                cont_normal = 0;
            }
            if (((va<v_phase_max) || (va>v_phase_min)) || ((vb<v_phase_max) || (vb>v_phase_min)) || ((vc<v_phase_max) || (vc>v_phase_min)))
            {
                cont_norm_fase++;
            }
            else
            {
                cont_norm_fase = 0;
            }
            if ((cont_normal >= 150) || (vdc < vdc_charged) || (cont_norm_fase >= 30) || (vdc*i_out>pot_max))
            {                                                       // cuando se enciende el estado, sube la tensión
                fault = 1;                                          // en la carga a más  de 850, pero es un tiempo
            }                                                       // breve, menor a 0.003[s], ese tiempo corresponde
                                                                    // a 150 ciclos de ejecución del código cla.
        break;
        default:
        break;
    }

    fault = 0;  // para probar estado de fallas, quitar esta linea
}

//#define idle            1
//#define sync_pll        2
//#define pre_charge      3
//#define normal_mode     4
//#define apagado         5
//#define fault_mode      6

void corrimiento_izq(float v1, float v2, float v3, float v4, float v5, float v6, float v7, float v8){
    int i;
    for (i = 0; i < 40; i++){
        AdcBuf_ant_fall[i] = AdcBuf_ant_fall[i + 8];
    }
    AdcBuf_ant_fall[40] = v1;
    AdcBuf_ant_fall[41] = v2;
    AdcBuf_ant_fall[42] = v3;
    AdcBuf_ant_fall[43] = v4;
    AdcBuf_ant_fall[44] = v5;
    AdcBuf_ant_fall[45] = v6;
    AdcBuf_ant_fall[46] = v7;
    AdcBuf_ant_fall[47] = v8;
    return;
}




//
// cla1Isr1 - CLA1 ISR 1 - Fault mode
//
__interrupt void cla1Isr1 () // Fault mode
{
    AdcaRegs.ADCINTFLGCLR.bit.ADCINT1 = 1; //make sure INT1 flag is cleared
    if(1 == AdcaRegs.ADCINTOVF.bit.ADCINT1)
    {
        AdcaRegs.ADCINTOVFCLR.bit.ADCINT1 = 1; // limpia INT1 overflow flag
    }
    PieCtrlRegs.PIEACK.all = (PIEACK_GROUP1 | PIEACK_GROUP11);
    // Read the CLA_ADC value and put it in the AdcBuf_dsp_fall buffer
    //
    for (i = 0; i < 8; i++)
    {
        AdcBuf_dsp_fall[i+8*SampleCount] = adc_read[i];
    }
    // Make sure that the buffer does not overflow
    // the buffer size.  If it is larger than 10
    // then rewind back to the sample 0
    //
    SampleCount++;
    if( SampleCount == 10 )
    {
        SampleCount = 0;
        fault = 0;
    }
}

//
// cla1Isr2 - CLA1 ISR 2 - Sync_PLL
//
__interrupt void cla1Isr2 () // Sync_PLL
{

//--------------variables-pll----------------//
    vg_d_men_prom_l = vg_d_men_prom_g; // l cpu->cla, g cla->cpu
    vg_q_men_prom_l = vg_q_men_prom_g;
    vg_d_mas_prom_l = vg_d_mas_prom_g;
    vg_q_mas_prom_l = vg_q_mas_prom_g;

    vg_d_men_ref_ant_l = vg_d_men_ref_ant_g;
    vg_d_men_prom_ant_l = vg_d_men_prom_ant_g;
    vg_q_men_ref_ant_l = vg_q_men_ref_ant_g;
    vg_q_men_prom_ant_l = vg_q_men_prom_ant_g;

    vg_d_mas_ref_ant_l = vg_d_mas_ref_ant_g;
    vg_d_mas_prom_ant_l = vg_d_mas_prom_ant_g;
    vg_q_mas_ref_ant_l = vg_q_mas_ref_ant_g;
    vg_q_mas_prom_ant_l = vg_q_mas_prom_ant_g;
//-------------------------------------------//
//------------variables-pi-pll---------------//
    integr_ddsrf_l = integr_ddsrf_g;
    integr_ddsrf_ant_l = integr_ddsrf_ant_g;
    theta_ddsrf_ant_l = theta_ddsrf_ant_g;
    theta_ddsrf_l = theta_ddsrf_g;
//-------------------------------------------//


//---------------variables-dq----------------//
    vg_d  = a9;
    vg_q  = a10;
//-------------------------------------------//
corrimiento_izq (a1, a2, a3, a4, a5, a6, a7, a8); // Guardado de datos


    aaa ++;
    if (aaa >= 10)
        {
            aaa   = 0;
            vg_q1 = 0;
        }
    AdcaRegs.ADCINTFLGCLR.bit.ADCINT1 = 1; // limpia el bit de la INT1 flag
    // Revisa si ocurrió overflow
    //
    if(1 == AdcaRegs.ADCINTOVF.bit.ADCINT1)
    {
        AdcaRegs.ADCINTOVFCLR.bit.ADCINT1 = 1; // limpia INT1 overflow flag
    }
    PieCtrlRegs.PIEACK.all = (PIEACK_GROUP1 | PIEACK_GROUP11);
}

//
// cla1Isr3 - CLA1 ISR 3
//
__interrupt void cla1Isr3 ()
{
    asm(" ESTOP0");
}

//
// cla1Isr4 - CLA1 ISR 4
//
__interrupt void cla1Isr4 ()
{
    asm(" ESTOP0");
}

//
// cla1Isr5 - CLA1 ISR 5
//
__interrupt void cla1Isr5 ()
{
    asm(" ESTOP0");
}

//
// cla1Isr6 - CLA1 ISR 6 - Modo de Fallas

//
__interrupt void cla1Isr6 ()
{
//--------------variables-pll----------------//
    vg_d_men_prom_l = vg_d_men_prom_g; // l cpu->cla, g cla->cpu
    vg_q_men_prom_l = vg_q_men_prom_g;
    vg_d_mas_prom_l = vg_d_mas_prom_g;
    vg_q_mas_prom_l = vg_q_mas_prom_g;

    vg_d_men_ref_ant_l = vg_d_men_ref_ant_g;
    vg_d_men_prom_ant_l = vg_d_men_prom_ant_g;
    vg_q_men_ref_ant_l = vg_q_men_ref_ant_g;
    vg_q_men_prom_ant_l = vg_q_men_prom_ant_g;

    vg_d_mas_ref_ant_l = vg_d_mas_ref_ant_g;
    vg_d_mas_prom_ant_l = vg_d_mas_prom_ant_g;
    vg_q_mas_ref_ant_l = vg_q_mas_ref_ant_g;
    vg_q_mas_prom_ant_l = vg_q_mas_prom_ant_g;
//-------------------------------------------//
//------------variables-pi-pll---------------//
    integr_ddsrf_l = integr_ddsrf_g;
    integr_ddsrf_ant_l = integr_ddsrf_ant_g;
    theta_ddsrf_ant_l = theta_ddsrf_ant_g;
    theta_ddsrf_l = theta_ddsrf_g;
//-------------------------------------------//
//----------Controlador-de-voltaje-----------//
    x_ant_v_l = x_ant_v_g;
    x_v_l     = x_v_g;
//-------------------------------------------//
//---------Controlador-de-corriente-d--------//
    x_ant_id_l = x_ant_id_g;
    x_id_l     = x_id_g;
//-------------------------------------------//
//---------Controlador-de-corriente-q--------//
    x_ant_iq_l = x_ant_iq_g;
    x_iq_l     = x_iq_g;
//-------------------------------------------//
//---------------variables-pll---------------//
    vdc   = a1;
    va    = a2;
    vb    = a3;
    vc    = a4;
    i_out = a8;
//-------------------------------------------//

    corrimiento_izq (a1, a2, a3, a4, a5, a6, a7, a8); // Guardado de datos

    // Escritura escalada de variables
    if (aaa <= 2)

    {
        aaa++;
    }
    else
    {
        aaa = 0;
        if (i < largo_theta)
        {
            theta_buff[i] = a3;
            alfa_buff[i]  = a1; //    a1 = vg_d;
            beta_buff[i]  = a2; //    a2 = vg_q;
            i++;
        }
        else
        {
            i = 0;
        }
    }

//    if (i < largo_theta)
//    {
////        theta_buff[i] = theta_l;
//        theta_buff[i] = a3;
//        alfa_buff[i]  = a1; //    a1 = vg_d;
//        beta_buff[i]  = a2; //    a2 = vg_q;
//        i++;
//    }
//    else
//    {
//        i = 0;
//    }


    AdcaRegs.ADCINTFLGCLR.bit.ADCINT1 = 1; // limpia el bit de la INT1 flag
    // Revisa si ocurrió overflow
    //
    if(1 == AdcaRegs.ADCINTOVF.bit.ADCINT1)
    {
        AdcaRegs.ADCINTOVFCLR.bit.ADCINT1 = 1; // limpia INT1 overflow flag
        AdcaRegs.ADCINTFLGCLR.bit.ADCINT1 = 1; //Re-clear ADCINT flag
    }
    PieCtrlRegs.PIEACK.all = (PIEACK_GROUP1 | PIEACK_GROUP11);

    GPIO_WritePin(BLINKY_LED_GPIO, 0);

}

//
// cla1Isr7 - CLA1 ISR 7 - Normal mode
//
__interrupt void cla1Isr7 () // Normal mode
{

//--------------variables-pll----------------//
    vg_d_men_prom_l = vg_d_men_prom_g; // l cpu->cla, g cla->cpu
    vg_q_men_prom_l = vg_q_men_prom_g;
    vg_d_mas_prom_l = vg_d_mas_prom_g;
    vg_q_mas_prom_l = vg_q_mas_prom_g;

    vg_d_men_ref_ant_l = vg_d_men_ref_ant_g;
    vg_d_men_prom_ant_l = vg_d_men_prom_ant_g;
    vg_q_men_ref_ant_l = vg_q_men_ref_ant_g;
    vg_q_men_prom_ant_l = vg_q_men_prom_ant_g;

    vg_d_mas_ref_ant_l = vg_d_mas_ref_ant_g;
    vg_d_mas_prom_ant_l = vg_d_mas_prom_ant_g;
    vg_q_mas_ref_ant_l = vg_q_mas_ref_ant_g;
    vg_q_mas_prom_ant_l = vg_q_mas_prom_ant_g;
//-------------------------------------------//
//------------variables-pi-pll---------------//
    integr_ddsrf_l = integr_ddsrf_g;
    integr_ddsrf_ant_l = integr_ddsrf_ant_g;
    theta_ddsrf_ant_l = theta_ddsrf_ant_g;
    theta_ddsrf_l = theta_ddsrf_g;
//-------------------------------------------//

//----------Controlador-de-voltaje-----------//
    x_ant_v_l = x_ant_v_g;
    x_v_l     = x_v_g;
//-------------------------------------------//
//---------Controlador-de-corriente-d--------//
    x_ant_id_l = x_ant_id_g;
    x_id_l     = x_id_g;
//-------------------------------------------//
//---------Controlador-de-corriente-q--------//
    x_ant_iq_l = x_ant_iq_g;
    x_iq_l     = x_iq_g;
//-------------------------------------------//
//---------------variables-pll---------------//
    vdc   = a1;
    va    = a2;
    vb    = a3;
    vc    = a4;
    i_out = a8;
//-------------------------------------------//

corrimiento_izq (a1, a2, a3, a4, a5, a6, a7, a8); // Guardado de datos


EPwm2Regs.CMPA.bit.CMPA = 250*(v_conv_a + 1);
EPwm3Regs.CMPA.bit.CMPA = 250*(v_conv_b + 1);
EPwm4Regs.CMPA.bit.CMPA = 250*(v_conv_c + 1);

//    valores;

//    vect[0] = va[k];
//    vect[1] = vb[k];
//    vect[2] = vc[k];
//    vect[3] = ia[k];
//    vect[4] = ib[k];
//    vect[5] = ic[k];


//    vect[0] = valores_3[4*k+1];
//    vect[1] = valores_3[4*k+2];
//    vect[2] = valores_3[4*k+3];

//    for (i = 0; i < 70; i++)
//    if (aaa <= 20)

    // Escritura escalada de variables
//    if (aaa <= 2)
//
//    {
//        aaa++;
//    }
//    else
//    {
//        aaa = 0;
//        if (i < largo_theta)
//        {
////            theta_buff[i] = a3;
//            alfa_buff[i]  = a1; //    a1 = vg_d;
//            beta_buff[i]  = a2; //    a2 = vg_q;
//            i++;
//        }
//        else
//        {
//            i = 0;
//        }
//    }

    if (i < largo_theta)
    {
        alfa_buff[i]  = a1; //    a1 = vg_d;
        beta_buff[i]  = a2; //    a2 = vg_q;
        i++;
    }
    else
    {
        i = 0;
    }




//    if ((i < largo_theta) & (aaa == 0))
//    {
//        theta_buff[i] = theta_l;
//        alfa_buff[i] = a2;
//        i++;
//    }
//    else
//    {
//        i = 0;
//    }

//    SampleCount++;
//    if( SampleCount == 10 )
//    {
//        SampleCount = 0;
//        fault = 0;
//    }

//    k++;

//    aaa++;
//    if (aaa >= 40)
//    {
//        bbb ++;
//        aaa = 0;
////        boton_2 = 1;
//    }
//    if (k >=401)
//    {
//        k = 0;

//    }



    AdcaRegs.ADCINTFLGCLR.bit.ADCINT1 = 1; // limpia el bit de la INT1 flag
    // Revisa si ocurrió overflow
    //
    if(1 == AdcaRegs.ADCINTOVF.bit.ADCINT1)
    {
        AdcaRegs.ADCINTOVFCLR.bit.ADCINT1 = 1; // limpia INT1 overflow flag
        AdcaRegs.ADCINTFLGCLR.bit.ADCINT1 = 1; //Re-clear ADCINT flag
    }
    PieCtrlRegs.PIEACK.all = (PIEACK_GROUP1 | PIEACK_GROUP11);



}

//
// cla1Isr8 - CLA1 ISR 8
//
__interrupt void cla1Isr8 ()
{
    PieCtrlRegs.PIEACK.all = M_INT11;
}

// End of File

